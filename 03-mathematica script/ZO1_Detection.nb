(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    237230,       4881]
NotebookOptionsPosition[    234994,       4833]
NotebookOutlinePosition[    235394,       4849]
CellTagsIndexPosition[    235351,       4846]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["ZO-1 - Detection", "Title",
 CellChangeTimes->{{3.656308037421206*^9, 3.656308055589389*^9}, {
  3.721540776877191*^9, 3.721540795852942*^9}, {3.739782676652048*^9, 
  3.739782685297204*^9}, {3.7398568251908817`*^9, 3.739856829530986*^9}, {
  3.7621731701330357`*^9, 3.762173197870191*^9}, {3.8449492211351423`*^9, 
  3.844949224263358*^9}},ExpressionUUID->"c69d61bb-3e4c-4e32-ae9f-\
027cafb2ac21"],

Cell[TextData[StyleBox["*    Author: Jahn, Johannes\n*    Date: 03/2025\n*    \
Code version: 1.0.0\n*   E-Mail: Johannes.Jahn@uniklinik-freiburg.de ", \
"SubitemParagraph"]], "Title",
 CellChangeTimes->{{3.656308037421206*^9, 3.656308055589389*^9}, {
   3.721540776877191*^9, 3.721540795852942*^9}, {3.739782676652048*^9, 
   3.739782685297204*^9}, 3.7398568251908817`*^9, {3.7398569944242716`*^9, 
   3.7398570737286577`*^9}, 3.7398571447361712`*^9, {3.740390313274071*^9, 
   3.7403903307342696`*^9}, {3.7449577698710995`*^9, 3.744957770965266*^9}, {
   3.762173120165595*^9, 3.7621731221156197`*^9}, {3.762173154002429*^9, 
   3.7621731599149046`*^9}, {3.7729551657413864`*^9, 
   3.7729551689536705`*^9}, {3.773732429204345*^9, 3.7737324294855947`*^9}, {
   3.8449492321769557`*^9, 3.844949239078847*^9}, {3.853810200605794*^9, 
   3.8538102065850306`*^9}, {3.8907145905064335`*^9, 3.89071459266514*^9}, {
   3.9507075698305883`*^9, 3.950707573151648*^9}, {3.9507076189957504`*^9, 
   3.950707619381201*^9}, {3.961150612034646*^9, 
   3.9611506121193013`*^9}},ExpressionUUID->"ff7b473d-92a2-473e-8f83-\
a3fa913a4dbc"],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Change log", "Chapter"]], "Section",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782730953672*^9}, {3.739782762869382*^9, 
   3.7397827644265146`*^9}, {3.7403903334381557`*^9, 
   3.7403903488335447`*^9}, {3.743748534903616*^9, 3.743748536601813*^9}, 
   3.8449492424652567`*^9},ExpressionUUID->"ba39ed6b-52c8-4469-bea2-\
d83c376712a1"],

Cell["\<\
v7
- preparation for publication\
\>", "Text",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782730953672*^9}, {3.739782762869382*^9, 
   3.7397827644265146`*^9}, {3.7403903334381557`*^9, 
   3.7403904193725758`*^9}, {3.7403905834092407`*^9, 3.740390691132037*^9}, {
   3.7403907479808507`*^9, 3.7403908611841946`*^9}, {3.74039152068596*^9, 
   3.7403915392737627`*^9}, {3.743748537683583*^9, 3.743748739541246*^9}, {
   3.743748784621332*^9, 3.7437488136900206`*^9}, {3.74375233411082*^9, 
   3.7437523807660437`*^9}, {3.744957772527788*^9, 3.744957846599478*^9}, {
   3.7449619050591197`*^9, 3.744961933769293*^9}, {3.745224643746434*^9, 
   3.745224744591775*^9}, {3.7452249070668163`*^9, 3.745224988172387*^9}, {
   3.7452250395708656`*^9, 3.745225084764697*^9}, {3.745225142086378*^9, 
   3.745225167373332*^9}, {3.7452292937613153`*^9, 3.7452293099353533`*^9}, {
   3.7613145194305725`*^9, 3.7613145822979794`*^9}, {3.7613857800369964`*^9, 
   3.761385800851348*^9}, {3.7613955533859262`*^9, 3.7613955703857617`*^9}, {
   3.761751047718271*^9, 3.761751059367858*^9}, 3.761751496768164*^9, {
   3.762172387391264*^9, 3.7621725326810637`*^9}, {3.7632797073230133`*^9, 
   3.763279741740988*^9}, {3.763279873890624*^9, 3.7632798812596607`*^9}, {
   3.763280253420432*^9, 3.7632802544068623`*^9}, {3.766925289996378*^9, 
   3.76692531191617*^9}, {3.7669253560369577`*^9, 3.76692537310643*^9}, {
   3.7729463655628653`*^9, 3.772946419785406*^9}, {3.772947017672103*^9, 
   3.7729470375472436`*^9}, {3.772957066867228*^9, 3.772957082912645*^9}, 
   3.7729572589784765`*^9, {3.7737324309072137`*^9, 3.773732443192358*^9}, {
   3.7741630074072394`*^9, 3.774163036107876*^9}, {3.774175791249324*^9, 
   3.7741758232859697`*^9}, {3.774196184395273*^9, 3.774196223962703*^9}, {
   3.7742558744406505`*^9, 3.774255888067294*^9}, {3.774271420621975*^9, 
   3.7742714635373793`*^9}, {3.777636308962387*^9, 3.7776363274095273`*^9}, {
   3.77763637185712*^9, 3.7776365342816668`*^9}, {3.777704902235558*^9, 
   3.777704928175008*^9}, {3.844949244955*^9, 3.8449492824035015`*^9}, {
   3.8449971569320803`*^9, 3.8449972184806585`*^9}, {3.8449972701652145`*^9, 
   3.844997398142765*^9}, {3.8449974365639763`*^9, 3.844997894460026*^9}, {
   3.844998103271797*^9, 3.8449981280343246`*^9}, {3.844998178692175*^9, 
   3.844998216439868*^9}, {3.845002090910822*^9, 3.845002113552827*^9}, {
   3.8450082981106443`*^9, 3.845008322284752*^9}, {3.8450189623864822`*^9, 
   3.8450189923446836`*^9}, {3.845030340291238*^9, 3.8450303544592667`*^9}, {
   3.845089894460208*^9, 3.84508991890949*^9}, {3.8450918715753765`*^9, 
   3.845091917233689*^9}, {3.845093279461728*^9, 3.845093285893278*^9}, {
   3.8451100213397923`*^9, 3.845110120379525*^9}, {3.845110250804826*^9, 
   3.8451102755393305`*^9}, {3.845115259788618*^9, 3.845115260692278*^9}, {
   3.845115843334178*^9, 3.8451158442918367`*^9}, {3.8456060970430717`*^9, 
   3.845606113106451*^9}, {3.8456234258443108`*^9, 3.845623426546788*^9}, {
   3.8456248532107887`*^9, 3.8456248534820013`*^9}, {3.845625024383871*^9, 
   3.8456250447452526`*^9}, {3.8456298587816825`*^9, 
   3.8456298615616484`*^9}, {3.846208140760785*^9, 3.846208169000848*^9}, {
   3.8462082397310905`*^9, 3.846208272866632*^9}, {3.8462083332475233`*^9, 
   3.846208335739292*^9}, {3.8522796462264643`*^9, 3.8522796708369675`*^9}, {
   3.8522802838399706`*^9, 3.8522803260359836`*^9}, {3.852280382201932*^9, 
   3.852280387807922*^9}, {3.852282053399233*^9, 3.85228214185515*^9}, {
   3.852282183822998*^9, 3.8522821872964687`*^9}, {3.852282223381137*^9, 
   3.852282240730474*^9}, 3.8522822769152107`*^9, {3.8522826529356594`*^9, 
   3.8522826571916857`*^9}, {3.8522828325384035`*^9, 
   3.8522828473069077`*^9}, {3.864888412568801*^9, 3.864888436924115*^9}, {
   3.8907145850758305`*^9, 3.890714635203251*^9}, {3.9507075821324143`*^9, 
   3.9507076009326143`*^9}},ExpressionUUID->"723d581d-4bbc-4f03-9cb9-\
83787b774a67"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Initializing", "Chapter"]], "Section",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782730953672*^9}, {3.739782762869382*^9, 
   3.7397827644265146`*^9}, 3.7403903334381557`*^9, 
   3.844949456696868*^9},ExpressionUUID->"4fa0351b-8f85-4edc-88ad-\
4e22eeafcb8f"],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", 
    RowBox[{"Main", " ", "function"}], "*)"}], "Subsubsection"], 
  StyleBox["\[IndentingNewLine]", "Subsubsection"], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"zoAnalysis", "[", 
     RowBox[{
     "filePath_", ",", "filePathGFP_", ",", "gfp_", ",", "formAnalysis_", ",",
       "sBranch_", ",", "segFolder_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "imgproc", ",", "prun1", ",", "endPoints", ",", "pixel", ",", 
        "subsetLength", ",", "subSteps", ",", "branchRec4", ",", " ", 
        "branchRec5", ",", "skeleton", ",", "smoothEdges", ",", " ", 
        "skeleton2", ",", "prun2", ",", "diffmask", ",", "componentsPrunned", 
        ",", "pixelValueMask", ",", "numberMaskComponents", ",", 
        "dispatchTable", ",", "mask", ",", "cellComponents", ",", 
        "cellComponentsColored", ",", "cellComponentsSmooth", ",", 
        "cellComponentsSmoothColored", ",", "pattern2", ",", "data", ",", 
        "dataSmooth", ",", "parentfolder", ",", "fileName1", ",", "fileName2",
         ",", "fileName3", ",", "imgGFP", ",", "gfpCellNumbers", ",", 
        "gfpBool", ",", "data2", ",", "overlayGFP", ",", "sorting1", ",", 
        "dataMerged", ",", "rIndex", ",", "bp", ",", "bp2", ",", "bpBoth", 
        ",", "branchesRiffled", ",", "branchesSmooth", ",", 
        "selectedCellsImage", ",", "messRiffled", ",", "messSmooth", ",", " ",
         "combinations", ",", "dataMergedBranches", ",", "rIndexSubsegment", 
        ",", "neighbourNumbers", ",", "dataMergedBranches2", ",", 
        "dataMergedBranches3", ",", "cellGenotype", ",", 
        "dataMergedBranches4", ",", " ", "datacal1", ",", " ", "head1", ",", 
        "subhead", ",", "tableData1", ",", "datacal2", ",", " ", "head2", ",",
         "tableData2", ",", "measure", ",", "singleObjectMatrix", ",", 
        "singleObjectColored", ",", "overlayCellNumbers", ",", 
        "branchesRiffledSelected", ",", "overlaySingleBranch", ",", 
        "overlayRiffleRound", ",", "overlayRIndex", " ", ",", "failure", ",", 
        "thres2", ",", "imageGFP", ",", "imageNon", ",", "fiberDataAdvanced", 
        ",", "dataMergedBranches5"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{"(*", 
        RowBox[{"Import", " ", "and", " ", "branch", " ", "reconstruction"}], 
        "*)"}], "Subsubsection"], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "functions", " ", "for", " ", "better", " ", "memory", " ", 
         "management"}], ",", " ", 
        RowBox[{
        "will", " ", "help", " ", "when", " ", "processing", " ", "very", " ",
          "large", " ", "images", " ", "on", " ", "slower", " ", 
         "machines"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"$HistoryLength", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Share", "[", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ClearSystemCache", "[", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "import", " ", "and", " ", "adjust", " ", "the", " ", "segmented", 
          " ", "image", " ", "created", " ", "by", " ", "the", " ", "U"}], 
         "-", 
         RowBox[{"Net", " ", 
          RowBox[{"(", 
           RowBox[{"16", "bit", " ", "input"}], ")"}]}]}], "*)"}], 
       StyleBox["\[IndentingNewLine]", "Subsubsection"], 
       RowBox[{"imgproc", "=", 
        RowBox[{"ImageAdjust", "[", 
         RowBox[{"Import", "[", "filePath", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"delete", " ", "small", " ", "objects"}], ",", " ", 
         RowBox[{"mostly", " ", "background", " ", "noise"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"imgproc", "=", " ", 
         RowBox[{"DeleteSmallComponents", "[", 
          RowBox[{"imgproc", ",", 
           RowBox[{"Method", "\[Rule]", "\"\<Mean\>\""}]}], "]"}]}],
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox[";",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "The", " ", "segmented", " ", "cell", " ", "borders", " ", "can", 
           " ", "vary", " ", "in", " ", "the", " ", 
           RowBox[{"width", ".", " ", "With"}], " ", "Thinning", " ", "we", 
           " ", "reduce", " ", "all", " ", "to", " ", "a", " ", "one"}], "-", 
          
          RowBox[{"pixel", " ", "wide", " ", "line", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
             "makes", " ", "it", " ", "easy", " ", "to", " ", "work", " ", 
              "with", " ", "at", " ", "later", " ", "modelling", " ", 
              "steps"}], ")"}], ".", "\[IndentingNewLine]", 
            "SkeletonTransform"}], " ", "doesn\.b4t", " ", "work", " ", 
           "quite", " ", "well", " ", "with", " ", "Pruning"}]}], ",", " ", 
         RowBox[{"therefore", " ", "we", " ", "use", " ", "Thinning"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"prun1", "=", 
        RowBox[{"Binarize", "[", 
         RowBox[{
          RowBox[{"Thinning", "[", "imgproc", "]"}], ",", "0"}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"delete", " ", "small", " ", 
         RowBox[{"branches", "/", "segments"}], " ", "that", " ", "extend", 
         " ", "into", " ", "completely", " ", "segmented", " ", "cells"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"prun1", "=", 
        RowBox[{"Pruning", "[", 
         RowBox[{"prun1", ",", " ", "10"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       StyleBox["\[IndentingNewLine]", "Subsubsection"], 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"next", " ", 
          RowBox[{"steps", ":", " ", 
           RowBox[{"fill", " ", "small", " ", "gaps", " ", 
            RowBox[{"(", 
             RowBox[{"few", " ", "pixels"}], ")"}], " ", "in", " ", "the", 
            " ", "detected", " ", 
            RowBox[{"branches", "/", "cell"}], " ", "border", " ", 
            "segments"}]}]}], ";", " ", 
         RowBox[{
         "will", " ", "result", " ", "in", " ", "more", " ", "detectable", 
          " ", "cells", " ", "since", " ", "small", " ", "gaps", " ", "will", 
          " ", "not", " ", "dismiss", " ", "the", " ", "whole", " ", 
          RowBox[{"cell", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "generate", " ", "an", " ", "image", " ", "with", " ", "all", " ", 
         "endpoints", " ", "and", " ", "get", " ", "their", " ", 
         "coordinates"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"endPoints", " ", "=", 
        RowBox[{"MorphologicalTransform", "[", 
         RowBox[{"prun1", ",", " ", "\"\<EndPoints\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pixel", "=", 
        RowBox[{"PixelValuePositions", "[", 
         RowBox[{"endPoints", ",", " ", "1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "number", " ", "of", " ", "all", " ", "possible", " ", 
         "combinations"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"subsetLength", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Length", "[", "pixel", "]"}], "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Length", "[", "pixel", "]"}], "-", "1"}], ")"}]}], 
          ")"}], "/", "2"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "calls", " ", "a", " ", "helper", " ", "function", " ", "for", " ", 
         "branch", " ", 
         RowBox[{"reconstruction", ".", " ", "This"}], " ", "function", " ", 
         "will", " ", "analyse", " ", "all", " ", "possible", " ", 
         "connections", " ", "between", " ", "the", " ", "end", " ", "points",
          " ", "und", " ", "returns", " ", "a", " ", "list", " ", "of", " ", 
         "end", " ", "points", " ", "with", " ", "a", " ", "short", " ", 
         "distance", " ", "between", " ", 
         RowBox[{"them", ".", " ", "Calling"}], " ", "the", " ", "function", 
         " ", "in", " ", "smaller", " ", "parts", " ", 
         RowBox[{"(", 
          RowBox[{
          "100.000", " ", "in", " ", "each", " ", "function", " ", "call"}], 
          ")"}], " ", "will", " ", "reduce", " ", "memory", " ", "load"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"subSteps", "=", 
        RowBox[{
         RowBox[{"Prepend", "[", 
          RowBox[{
           RowBox[{"{", "subsetLength", "}"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{"k", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "1", ",", "subsetLength", ",", "100000"}], 
              "}"}]}], "]"}]}], "]"}], "//", "Flatten"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"branchRec4", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"branchRec", "[", 
             RowBox[{"pixel", ",", 
              RowBox[{"subSteps", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"subSteps", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", "subSteps", "]"}], "-", "1"}]}], 
             "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "draws", " ", "a", " ", "white", " ", "line", " ", "between", " ", 
           "the", " ", "endpoints", " ", "that", " ", "are", " ", "close", 
           " ", 
           RowBox[{"together", ".", " ", "branchRec5"}], " ", "is", " ", "an",
            " ", "Image"}], "-", "object"}], ",", " ", 
         RowBox[{
         "so", " ", "the", " ", "lines", " ", "are", " ", "drawn", " ", "on", 
          " ", "the", " ", "image"}], ",", " ", 
         RowBox[{
         "Thinning", " ", "and", " ", "Pruning", " ", "must", " ", "be", " ", 
          "repeated"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"branchRec5", "=", " ", 
        RowBox[{"Binarize", "[", 
         RowBox[{"Show", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"imgproc", ",", 
             RowBox[{"Graphics", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Thickness", "[", "0.003", "]"}], ",", "White", ",", 
                RowBox[{"Line", "@", "branchRec4"}]}], "}"}], "]"}]}], "}"}], 
           ",", 
           RowBox[{"ImageSize", "\[Rule]", " ", 
            RowBox[{"ImageDimensions", "[", "imgproc", "]"}]}]}], "]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"memory", " ", "management", " ", "functions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ClearAll", "[", 
        RowBox[{
        "imgproc", ",", "prun1", ",", " ", "endPoints", ",", "pixel", ",", 
         "branchRec4"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ClearSystemCache", "[", "]"}], ";", "\[IndentingNewLine]", 
       "\n", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{"Skeleton", " ", "construction"}], "*)"}], "Subsubsection"], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "on", " ", "the", " ", "reconstruced", " ", "branch", " ", "image", 
         " ", "again", " ", "the", " ", "Thinning", " ", "and", " ", 
         "Pruning", " ", "is", " ", "aplied", " ", 
         RowBox[{"(", 
          RowBox[{"same", " ", "as", " ", "above"}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"skeleton", "=", 
        RowBox[{"Thinning", "[", "branchRec5", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"skeleton", "=", 
        RowBox[{"Pruning", "[", 
         RowBox[{"skeleton", ",", " ", "10"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
           "the", " ", "riffle", " ", "pattern", " ", "of", " ", "the", " ", 
            "cell", " ", "borders", " ", "is", " ", "smoothed"}], " ", "-", 
           " ", 
           RowBox[{
           "this", " ", "is", " ", "the", " ", "key", " ", "feature", " ", 
            "for", " ", "later", " ", "calculation", " ", "of", " ", "the", 
            " ", "R"}], "-", 
           RowBox[{
           "Index", " ", "that", " ", "is", " ", "a", " ", "marker", " ", 
            "for", " ", "cell", " ", "border", " ", "riffle", " ", 
            RowBox[{"strength", ".", "\[IndentingNewLine]", 
             RowBox[{"https", ":"}]}]}]}], "//", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
              "questions"}], "/", "149661"}], "/", "how"}], "-", "to", "-", 
           "get", "-", "a", "-", "smooth", "-", "ridge", "-", "from", "-", 
           "a", "-", "binary", "-", 
           RowBox[{"image", "/", "149664"}]}]}], ";", " ", 
         RowBox[{"(", 
          RowBox[{"website", " ", "last", " ", 
           RowBox[{"visited", ":", " ", 
            RowBox[{
             RowBox[{"11.", " ", "Nov", " ", "2021"}], " ", "-", " ", "3"}], 
            ":", 
            RowBox[{"26", " ", 
             RowBox[{"p", ".", "m", "."}]}]}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"smoothEdges", " ", "=", " ", 
        RowBox[{"ImageAdjust", "[", 
         RowBox[{
         "skeleton", "~", "Blur", "~", "12", "~", "Erosion", "~", "3", "~", 
          "RidgeFilter", "~", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Thinning", " ", "and", " ", "Pruning", " ", "is", " ", "also", " ", 
         "applied", " ", "to", " ", "the", " ", "smooth", " ", "image"}], 
        "*)"}], "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"skeleton2", " ", "=", " ", 
         RowBox[{"Thinning", "[", 
          RowBox[{"Binarize", "[", "smoothEdges", "]"}], "]"}]}],
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox[";",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox[
        RowBox[{"skeleton2", "=", 
         RowBox[{"Pruning", "[", 
          RowBox[{"skeleton2", ",", " ", "15"}], "]"}]}],
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox[";",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       RowBox[{"(*", 
        RowBox[{"memory", " ", "management", " ", "functions"}], "*)"}], 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       RowBox[{"ClearAll", "[", 
        RowBox[{"smoothEdges", ",", "branchRec5"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ClearSystemCache", "[", "]"}], ";", "\n", 
       "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{"Diffmask", " ", "construction"}], "*)"}], "Subsubsection"], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "in", " ", "the", " ", "next", " ", "steps", " ", "the", " ", "so", 
         " ", "called", " ", 
         RowBox[{"(", 
          RowBox[{"diff", "-"}], ")"}], "mask", " ", "is", " ", 
         RowBox[{"constructed", ".", " ", "This"}], " ", "mask", " ", 
         "contains", " ", "the", " ", "information", " ", "about", " ", 
         "incorrectly", " ", "segmented", " ", "areas", " ", "and", " ", 
         "incompletely", " ", "segmented", " ", "and", " ", "detected", " ", 
         RowBox[{"cells", ".", " ", "This"}], " ", "mask", " ", "is", " ", 
         "later", " ", "used", " ", "to", " ", "exclude", " ", "these", " ", 
         "image", " ", "parts", " ", "and", " ", "cells"}], "*)"}], 
       "\[IndentingNewLine]", 
       StyleBox["\[IndentingNewLine]",
        FontWeight->"Bold",
        FontColor->RGBColor[0., 0., 0.]], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"pruning", " ", "is", " ", "time", " ", "consuming"}], ",", 
         " ", 
         RowBox[{
         "20", " ", "pixel", " ", "is", " ", "enough", " ", "to", " ", 
          "gather", " ", "enough", " ", "information"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"prun2", "=", 
        RowBox[{"Pruning", "[", 
         RowBox[{"skeleton", ",", " ", 
          RowBox[{"{", "20", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"background", ":", " ", 
          RowBox[{
          "when", " ", "the", " ", "cell", " ", "border", " ", "of", " ", 
           "one", " ", "cell", " ", "is", " ", "entirely", " ", "segmented", 
           " ", "we", " ", "get", " ", "no", " ", 
           RowBox[{"holes", "/", "end"}], " ", "points", " ", "in", " ", 
           "this", " ", 
           RowBox[{"section", ".", " ", "When"}], " ", "endpoints", " ", 
           "exist", " ", 
           RowBox[{"(", 
            RowBox[{
            "that", " ", "are", " ", "detected", " ", "via", " ", "the", " ", 
             "Pruning", " ", "step", " ", "before"}], ")"}], " ", "this", " ",
            "indicates", " ", "a", " ", "hole", " ", "in", " ", "the", " ", 
           "mesh", " ", "of", " ", "cell", " ", 
           RowBox[{"borders", ".", " ", "Accordingly"}]}]}], ",", " ", 
         RowBox[{
         "the", " ", "difference", " ", "between", " ", "the", " ", 
          "starting", " ", "image", " ", "and", " ", "prun2", " ", 
          "represents", " ", "branches", " ", "of", " ", "incorrect", " ", 
          "segmented", " ", "areas", " ", "and", " ", "incomplete", " ", 
          "segmented", " ", "cells"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"diffmask", "=", " ", 
        RowBox[{"skeleton", " ", "-", " ", "prun2"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "use", " ", "the", " ", "MorpholocialComponents", " ", "function", 
          " ", "to", " ", "detect", " ", "the", " ", "single", " ", "cell", 
          " ", "objects", " ", "in", " ", "the", " ", "prunned", " ", 
          "image"}], ",", " ", 
         RowBox[{
         "CornerNeighbhors", " ", "is", " ", "important", " ", "to", " ", 
          "separate", " ", "the", " ", "individual", " ", "cells"}]}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"componentsPrunned", "=", 
        RowBox[{"MorphologicalComponents", "[", 
         RowBox[{
          RowBox[{"ColorNegate", "[", "prun2", "]"}], ",", 
          RowBox[{"CornerNeighbors", "\[Rule]", "False"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "get", " ", "the", " ", "pixels", " ", "from", " ", "the", " ", 
         "trimmed", " ", "branches"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pixelValueMask", "=", 
        RowBox[{"PixelValuePositions", "[", 
         RowBox[{"diffmask", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "since", " ", "we", " ", "work", " ", "on", " ", "a", " ", 
          "component", " ", "image", " ", "PixelValue", " ", "returns", " ", 
          "the", " ", "exact", " ", "number", " ", "of", " ", "each", " ", 
          "component"}], ",", " ", 
         RowBox[{
         "that", " ", "has", " ", "an", " ", "\"\<underlaying\>\"", " ", 
          "trimmed", " ", "branch"}], ",", " ", 
         RowBox[{
         "therefore", " ", "is", " ", "part", " ", "of", " ", "an", " ", 
          "incorrectly", " ", "detected", " ", "area"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"numberMaskComponents", "=", 
        RowBox[{"Round", "[", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"PixelValue", "[", 
           RowBox[{
            RowBox[{"Image", "[", "componentsPrunned", "]"}], ",", 
            "pixelValueMask"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"build", " ", "a", " ", "dispatch", " ", 
          RowBox[{"table", ".", " ", "Components"}], " ", "that", " ", "were",
           " ", "classified", " ", "as", " ", "a", " ", "part", " ", "of", 
          " ", "an", " ", "incorrectly", " ", "detected", " ", "area", " ", 
          "in", " ", "the", " ", "step", " ", "before"}], ",", " ", 
         RowBox[{"are", " ", "set", " ", "to", " ", "\"\<1\>\""}], ",", " ", 
         RowBox[{"otherwise", " ", 
          RowBox[{"\"\<0\>\"", ".", " ", "Black"}], " ", "parts", " ", "that",
           " ", "got", " ", "the", " ", "notation", " ", "\"\<0\>\"", " ", 
          "before", " ", "stay", " ", "the", " ", "same"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"dispatchTable", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", "\[Rule]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"numberMaskComponents", ",", "i"}], "]"}], ",", "1", 
              ",", "0"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Max", "[", "componentsPrunned", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dispatchTable", "=", 
        RowBox[{
         RowBox[{"Prepend", "[", 
          RowBox[{"dispatchTable", ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", "\[Rule]", "0"}], "}"}]}], "]"}], "//", 
         "Flatten"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "create", " ", "mask", " ", "based", " ", "on", " ", "the", " ", 
          "dispatch", " ", "table"}], ";", " ", 
         RowBox[{
         "the", " ", "mask", " ", "will", " ", "later", " ", "be", " ", 
          "used", " ", "to", " ", "delete", " ", "the", " ", "incorrectly", 
          " ", "detected", " ", "objects", " ", "in", " ", "the", " ", 
          "actual", " ", "image"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mask", "=", 
        RowBox[{"Binarize", "[", 
         RowBox[{
          RowBox[{"Image", "[", 
           RowBox[{"componentsPrunned", "/.", 
            RowBox[{"Dispatch", "[", "dispatchTable", "]"}]}], "]"}], ",", 
          "0"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"memory", " ", "management", " ", "functions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ClearAll", "[", 
        RowBox[{
        "prun2", ",", "diffmask", ",", "pixelValueMask", ",", 
         "componentsPrunned", ",", "dispatchTable"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ClearSystemCache", "[", "]"}], ";", 
       StyleBox["\[IndentingNewLine]", "Subsubsection"], 
       StyleBox["\[IndentingNewLine]", "Subsubsection"], 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{"Cell", " ", "object", " ", "detection"}], "*)"}], 
        "Subsubsection"], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "convert", " ", "the", " ", "segmented", " ", "image", " ", "into", 
         " ", "the", " ", "single", " ", "cell", " ", "objects", " ", "and", 
         " ", "remove", " ", "small", " ", "and", " ", "false", " ", 
         "detected", " ", "objects"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "use", " ", "the", " ", "MorpholocialComponents", " ", "function", 
          " ", "to", " ", "detect", " ", "the", " ", "single", " ", "cell", 
          " ", "objects", " ", "in", " ", "the", " ", "segmented"}], ",", " ", 
         RowBox[{"preprocessed", " ", "image"}], ",", " ", 
         RowBox[{
         "CornerNeighbhors", " ", "is", " ", "important", " ", "to", " ", 
          "separate", " ", "the", " ", "individual", " ", "cells"}]}], "*)"}], 
       StyleBox["\[IndentingNewLine]", "Subsubsection"], 
       RowBox[{"cellComponents", "=", 
        RowBox[{"MorphologicalComponents", "[", 
         RowBox[{
          RowBox[{"ColorNegate", "[", "skeleton", "]"}], ",", 
          RowBox[{"CornerNeighbors", "\[Rule]", "False"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "the", " ", "helper", " ", "function", " ", "is", " ", "used", " ", 
         "to", " ", "delete", " ", "objects", " ", "smaller", " ", "than", 
         " ", "2500", " ", 
         RowBox[{"pixels", ".", " ", "Implemented"}], " ", "via", " ", 
         "helper", " ", "function", " ", "since", " ", "it", " ", "showed", 
         " ", "better", " ", "performance", " ", "on", " ", "large", " ", 
         "images", " ", "compared", " ", "to", " ", "the", " ", "generic", 
         " ", "Mathematica", " ", 
         RowBox[{"function", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"cellComponents", " ", "=", 
        RowBox[{"selectComps", "[", 
         RowBox[{"cellComponents", ",", "2500"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "previously", " ", "generated", " ", "mask", " ", "is", 
          " ", "used", " ", "to", " ", "exclude", " ", "incorrectly", " ", 
          "segmented", " ", "parts", " ", "and", " ", "cells", " ", "in", " ",
           "the", " ", 
          RowBox[{"image", ".", " ", "Again"}]}], ",", " ", 
         RowBox[{
         "a", " ", "helper", " ", "function", " ", "is", " ", "used", " ", 
          "that", " ", "is", " ", "based", " ", "on", " ", "a", " ", "matrix",
           " ", "implementation", " ", "for", " ", "performance", " ", 
          "reasons"}], ",", " ", 
         RowBox[{"especially", " ", "on", " ", "large", " ", "image"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"cellComponents", "=", 
        RowBox[{"computeComponentDiff", "[", 
         RowBox[{"cellComponents", ",", "mask", ",", "0.1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"cells", "/", "objects"}], " ", "that", " ", "touch", " ", 
         "the", " ", "image", " ", "border", " ", 
         RowBox[{"(", 
          RowBox[{"=", 
           RowBox[{"incomplete", " ", "cells"}]}], ")"}], " ", "are", " ", 
         "excluded"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"cellComponents", "=", 
        RowBox[{"SelectComponents", "[", 
         RowBox[{"cellComponents", ",", 
          RowBox[{
           RowBox[{"#AdjacentBorderCount", "==", "0"}], "&"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "since", " ", "we", " ", "might", " ", "have", " ", "removed", " ", 
         "a", " ", "few", " ", "objects", " ", "in", " ", "the", " ", "steps",
          " ", "before", " ", "the", " ", "component", " ", "numbering", " ", 
         "is", " ", 
         RowBox[{"off", ".", " ", "With"}], " ", "converting", " ", "into", 
         " ", "an", " ", "image", " ", "and", " ", "again", " ", "applieng", 
         " ", "the", " ", "MorphologicalComponents", " ", "function", " ", 
         "the", " ", "numbering", " ", "is", " ", "reseted"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"cellComponents", " ", "=", 
        RowBox[{"MorphologicalComponents", "[", 
         RowBox[{
          RowBox[{"Image", "[", "cellComponents", "]"}], ",", 
          RowBox[{"CornerNeighbors", "\[Rule]", "False"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "create", " ", "an", " ", "image", " ", "with", " ", "colored", " ", 
         "cells"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"cellComponentsColored", "=", 
        RowBox[{"cellComponents", "//", "Colorize"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "same", " ", "functions", " ", "as", " ", "above", " ", "now", " ", 
         "for", " ", "the", " ", "smooth", " ", "skeleton"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"cellComponentsSmooth", "=", 
        RowBox[{"MorphologicalComponents", "[", 
         RowBox[{
          RowBox[{"ColorNegate", "[", "skeleton2", "]"}], ",", 
          RowBox[{"CornerNeighbors", "\[Rule]", "False"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cellComponentsSmooth", " ", "=", 
        RowBox[{"selectComps", "[", 
         RowBox[{"cellComponentsSmooth", ",", "2500"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cellComponentsSmooth", "=", 
        RowBox[{"computeComponentDiff", "[", 
         RowBox[{"cellComponentsSmooth", ",", "mask", ",", "0.1"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"cellComponentsSmooth", "=", 
        RowBox[{"SelectComponents", "[", 
         RowBox[{"cellComponentsSmooth", ",", 
          RowBox[{
           RowBox[{"#AdjacentBorderCount", "==", "0"}], "&"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"cellComponentsSmooth", " ", "=", 
        RowBox[{"MorphologicalComponents", "[", 
         RowBox[{
          RowBox[{"Image", "[", "cellComponentsSmooth", "]"}], ",", 
          RowBox[{"CornerNeighbors", "\[Rule]", "False"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cellComponentsSmoothColored", "=", 
        RowBox[{"cellComponentsSmooth", "//", "Colorize"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"memory", " ", "management", " ", "functions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ClearAll", "[", "mask", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ClearSystemCache", "[", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{"Measurement", " ", "readout"}], "*)"}], "Subsubsection"], 
       "\[IndentingNewLine]", 
       StyleBox["\[IndentingNewLine]", "Subsubsection"], 
       RowBox[{"(*", 
        RowBox[{"collect", " ", "measurements", " ", "for", " ", "the", " ", 
         RowBox[{"components", "/", "cell"}], " ", "objects"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"ComponentMeasurements", "[", 
         RowBox[{"cellComponents", ",", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Area\>\"", ",", "\"\<EquivalentDiskRadius\>\"", ",", 
            "\"\<AreaRadiusCoverage\>\"", ",", "\"\<AuthalicRadius\>\"", ",", 
            "\"\<OuterPerimeterCount\>\"", ",", "\"\<PerimeterLength\>\"", 
            ",", "\"\<MeanCentroidDistance\>\"", ",", 
            "\"\<MaxCentroidDistance\>\"", ",", "\"\<MinCentroidDistance\>\"",
             ",", "\"\<FilledCircularity\>\"", ",", "\"\<Rectangularity\>\"", 
            ",", " ", "\"\<Medoid\>\"", ",", "\"\<PolygonalLength\>\""}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"delete", " ", "list", " ", "associations"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", "data"}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "multiply", " ", "with", " ", "the", " ", "converting", " ", 
          RowBox[{"value", ":", " ", "Thus"}]}], ",", " ", 
         RowBox[{
          RowBox[{
          "we", " ", "get", " ", "measured", " ", "values", " ", "in", " ", 
           "\[Micro]m"}], ";", " ", 
          RowBox[{
          "all", " ", "values", " ", "before", " ", "were", " ", "pixel", " ",
            "values"}], ";", "\[IndentingNewLine]", 
          RowBox[{"values", " ", "like", " ", "FilledCircularity", " ", 
           RowBox[{"(", 
            RowBox[{"between", " ", "0", " ", "and", " ", "1"}], ")"}], " ", 
           "are", " ", "not", " ", "changed"}]}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"convertFunction1", "[", 
         RowBox[{"{", 
          RowBox[{
          "a_", ",", "b_", ",", "c_", ",", "d_", ",", "e_", ",", "f_", ",", 
           "g_", ",", "h_", ",", "i_", ",", "j_", ",", "k_", ",", "l_", ",", 
           "m_", ",", "n_"}], "}"}], "]"}], ":=", 
        RowBox[{"{", 
         RowBox[{"a", ",", 
          RowBox[{"b", "*", 
           RowBox[{"(", 
            RowBox[{"pixelSize", "^", "2"}], ")"}]}], ",", 
          RowBox[{"c", "*", "pixelSize"}], ",", "d", ",", 
          RowBox[{"e", "*", "pixelSize"}], ",", 
          RowBox[{"f", "*", "pixelSize"}], ",", 
          RowBox[{"g", "*", "pixelSize"}], ",", 
          RowBox[{"h", "*", "pixelSize"}], ",", 
          RowBox[{"i", "*", "pixelSize"}], ",", 
          RowBox[{"j", "*", "pixelSize"}], ",", "k", ",", "l", ",", "m", ",", 
          
          RowBox[{"n", "*", "pixelSize"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"convertFunction1", ",", "data"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"collect", " ", "measurements", " ", "for", " ", "the", " ", 
         RowBox[{"components", "/", "cell"}], " ", "objects", " ", "in", " ", 
         "the", " ", "smoothed", " ", 
         RowBox[{"image", ".", " ", "Here"}], " ", "only", " ", 
         "PolygonalLength", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"for", " ", "R"}], "-", 
           RowBox[{"index", " ", "calculation"}]}], ")"}], " ", "and", " ", 
         "the", " ", "Medoid", " ", 
         RowBox[{"(", 
          RowBox[{
          "later", " ", "used", " ", "by", " ", "the", " ", "function", " ", 
           "componentSorting", " ", "that", " ", "matches", " ", "the", " ", 
           "original", " ", "and", " ", "smooth", " ", "cell", " ", 
           "objects"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"dataSmooth", "=", 
        RowBox[{"ComponentMeasurements", "[", 
         RowBox[{"cellComponentsSmooth", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<Medoid\>\"", ",", "\"\<PolygonalLength\>\""}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dataSmooth", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
         "dataSmooth"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{
        "convert", " ", "function", " ", "is", " ", "applied", " ", "to", " ",
          "change", " ", "values", " ", "from", " ", "pixel", " ", 
         "\[Micro]m"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"convertFunction2", "[", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_", ",", "c_"}], "}"}], "]"}], ":=", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b", ",", 
          RowBox[{"c", "*", "pixelSize"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dataSmooth", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"convertFunction2", ",", "dataSmooth"}], "]"}]}], ";", "\n", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{"Generate", " ", "folder", " ", "names"}], "*)"}], 
        "Subsubsection"], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "stringReplace", " ", "function", " ", "deletes", " ", 
          "the", " ", "segmented", " ", "folder", " ", "name", " ", "and", 
          " ", "all", " ", "afterwards", " ", "parts", " ", "of", " ", "the", 
          " ", 
          RowBox[{"filename", ".", " ", "Thus"}]}], ",", " ", 
         RowBox[{
          RowBox[{
          "the", " ", "new", " ", "string", " ", "is", " ", "the", " ", 
           "path", " ", "of", " ", "the", " ", "parent"}], "-", "folder"}], 
         ",", " ", 
         RowBox[{
         "that", " ", "contains", " ", "all", " ", "relevant", " ", 
          "subfolders"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"parentfolder", "=", " ", 
        RowBox[{"StringReplace", "[", 
         RowBox[{"filePath", ",", 
          RowBox[{
           RowBox[{"segFolder", "~~", "___"}], "\[Rule]", "\"\<\>\""}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "for", " ", "the", " ", "new", " ", "filenames", " ", "the", " ", 
          "subfolder", " ", "and", " ", "original", " ", "filename", " ", 
          RowBox[{"(", 
           RowBox[{"without", " ", "file", " ", "extension"}], ")"}], " ", 
          "are", " ", "added"}], ";", " ", 
         RowBox[{
         "at", " ", "later", " ", "steps", " ", "short", " ", "suffixes", " ",
           "are", " ", "added", " ", "to", " ", "these", " ", "filenames"}]}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"fileName1", "=", 
        RowBox[{"parentfolder", "<>", "\"\</processing/\>\"", "<>", 
         RowBox[{"FileBaseName", "[", "filePath", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fileName2", "=", 
        RowBox[{"parentfolder", "<>", "\"\</processing_overlay/\>\"", "<>", 
         RowBox[{"FileBaseName", "[", "filePath", "]"}]}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fileName3", "=", 
        RowBox[{"parentfolder", "<>", "\"\</processing_xlsx/\>\"", "<>", 
         RowBox[{"FileBaseName", "[", "filePath", "]"}]}]}], " ", ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "if", " ", "not", " ", "existing", " ", "the", " ", "subfolders", 
          " ", "are", " ", 
          RowBox[{"created", ".", " ", "In"}], " ", "case", " ", "of", " ", 
          "the", " ", "overlay", " ", "folder", " ", "an", " ", "old", " ", 
          "name", " ", "was", " ", "used", " ", "in", " ", "the", " ", 
          "previous", " ", 
          RowBox[{"scripts", ".", " ", "When"}], " ", "a", " ", "folder", " ",
           "with", " ", "the", " ", "old", " ", "name", " ", "is", " ", 
          "found"}], ",", " ", 
         RowBox[{
         "the", " ", "name", " ", "is", " ", "changed", " ", "to", " ", "the",
           " ", "new", " ", "name"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"DirectoryQ", "[", 
           RowBox[{"parentfolder", " ", "<>", "\"\</processing/\>\""}], "]"}],
           " ", "==", " ", "False"}], ",", " ", 
         RowBox[{"CreateDirectory", "[", 
          RowBox[{"parentfolder", " ", "<>", "\"\</processing/\>\""}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"DirectoryQ", "[", 
            RowBox[{"parentfolder", "<>", "\"\</overlay_proc/\>\""}], "]"}], 
           " ", "==", " ", "True"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"DirectoryQ", "[", 
            RowBox[{"parentfolder", "<>", "\"\</processing_overlay/\>\""}], 
            "]"}], " ", "==", " ", "False"}]}], ",", " ", 
         RowBox[{"RenameDirectory", "[", 
          RowBox[{
           RowBox[{"parentfolder", "<>", "\"\</overlay_proc/\>\""}], ",", 
           RowBox[{"parentfolder", "<>", "\"\</processing_overlay/\>\""}]}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"DirectoryQ", "[", 
           RowBox[{"parentfolder", "<>", "\"\</processing_overlay/\>\""}], 
           "]"}], " ", "==", " ", "False"}], ",", 
         RowBox[{"CreateDirectory", "[", 
          RowBox[{"parentfolder", " ", "<>", "\"\</processing_overlay/\>\""}],
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"DirectoryQ", "[", 
           RowBox[{"parentfolder", "<>", "\"\</processing_xlsx/\>\""}], "]"}],
           " ", "==", " ", "False"}], ",", " ", 
         RowBox[{"CreateDirectory", "[", 
          RowBox[{"parentfolder", "<>", "\"\</processing_xlsx/\>\""}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\n", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "following", " ", "part", " ", "is", " ", "only", " ", 
          "executed"}], ",", " ", 
         RowBox[{
         "if", " ", "the", " ", "image", " ", "contains", " ", "at", " ", 
          "least", " ", "one", " ", "cell", " ", "object"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "data", "]"}], ">", "0"}], " ", "&&", 
          RowBox[{
           RowBox[{"Length", "[", "dataSmooth", "]"}], ">", "0"}]}], " ", ",",
          "\[IndentingNewLine]", 
         RowBox[{"(", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          StyleBox[
           RowBox[{"(*", 
            RowBox[{"GFP", " ", "processing"}], "*)"}], "Subsubsection"], 
          StyleBox["\[IndentingNewLine]", "Subsubsection"], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"gfp", "==", "True"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "The", " ", "GFP", " ", "processing", " ", "adds", " ", "an", 
                 " ", "additional", " ", "parameter", " ", "to", " ", "each", 
                 " ", "cell", " ", 
                 RowBox[{"object", ":", " ", 
                  RowBox[{
                  "If", " ", "the", " ", "cell", " ", "also", " ", "emitted", 
                   " ", "a", " ", "GFP", " ", "immunofluorescent", " ", 
                   RowBox[{"signal", ".", " ", "This"}], " ", "can", " ", 
                   "be", " ", "used", " ", "when", " ", "mixing", " ", "up", 
                   " ", "two", " ", "different", " ", "genotypes", " ", "in", 
                   " ", "one", " ", "preparation"}]}]}], ",", " ", 
                RowBox[{
                 RowBox[{"one", " ", "GFP"}], "-", 
                 RowBox[{
                  RowBox[{"labelled", ".", " ", "Now"}], " ", "it", " ", 
                  "can", " ", "be", " ", "reconstructed", " ", "which", " ", 
                  "cells", " ", "belongs", " ", "to", " ", "which", " ", 
                  RowBox[{"genotype", "."}]}]}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "import", " ", "the", " ", "corresponding", " ", "GFP", " ", 
                 "image", " ", "and", " ", "binarize", " ", "it"}], ";", " ", 
                
                RowBox[{
                "crop", " ", "to", " ", "correct", " ", "image", " ", 
                 "dimensions", " ", "to", " ", "reduce", " ", "errors"}]}], 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"imgGFP", " ", "=", " ", 
                RowBox[{"ImageCrop", "[", 
                 RowBox[{
                  RowBox[{"MorphologicalBinarize", "[", 
                   RowBox[{"Import", "[", "filePathGFP", "]"}], "]"}], ",", 
                  " ", 
                  RowBox[{
                  "ImageDimensions", "[", "cellComponentsColored", "]"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"all", " ", "cells", " ", 
                 RowBox[{"(", 
                  RowBox[{
                  "respectively", " ", "their", " ", "label", " ", 
                   "numbers"}], ")"}], " ", "are", " ", "selected", " ", 
                 "that", " ", "overlap", " ", "more", " ", "than", " ", "50", 
                 "%", " ", "with", " ", "the", " ", "GFP", " ", "image"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"thres2", "=", 
                RowBox[{
                 RowBox[{"#", " ", ">", "0.5"}], "&"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"gfpCellNumbers", "=", 
                RowBox[{"Cases", "[", 
                 RowBox[{
                  RowBox[{"ComponentMeasurements", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"cellComponents", " ", ",", "imgGFP"}], "}"}], 
                    ",", "\"\<MeanIntensity\>\""}], "]"}], ",", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"HoldPattern", "[", 
                    RowBox[{"i_", "\[Rule]", "v_"}], "]"}], "/;", 
                    RowBox[{"thres2", "[", "v", "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{"i", "\[Rule]", "0"}], ")"}]}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "remove", " ", "the", " ", "second", " ", "part", " ", "of", 
                 " ", "the", " ", "list", " ", "to", " ", "only", " ", "get", 
                 " ", "the", " ", "cell", " ", "numbers"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"gfpCellNumbers", "=", 
                RowBox[{"gfpCellNumbers", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "build", " ", "a", " ", "new", " ", "list", " ", "with", " ",
                   "bool"}], "-", 
                 RowBox[{"values", " ", "for", " ", "each", " ", "cell"}]}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"gfpBool", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"gfpCellNumbers", ",", "i"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "data", "]"}]}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "add", " ", "this", " ", "list", " ", "to", " ", "the", " ", 
                  "previously", " ", "acquired", " ", 
                  RowBox[{"data", ".", " ", 
                   RowBox[{"Important", ":", " ", 
                    RowBox[{
                    "This", " ", "step", " ", "must", " ", "be", " ", 
                    "executed"}]}]}]}], ",", " ", 
                 RowBox[{
                  RowBox[{
                  "before", " ", "we", " ", "start", " ", "the", " ", 
                   "componentSorting", " ", "function", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    "after", " ", "that", " ", "cell", " ", "numbers", " ", 
                    "don\.b4t", " ", "match"}], ")"}], "\[IndentingNewLine]", 
                   
                   RowBox[{"https", ":"}]}], "//", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"mathematica", ".", "stackexchange", ".", "com"}],
                     "/", "questions"}], "/", "47019"}], "/", "appending"}], 
                   "-", "element", "-", "to", "-", "sub", "-", 
                   RowBox[{"list", "\[IndentingNewLine]", 
                    RowBox[{"(", 
                    RowBox[{"website", " ", "last", " ", 
                    RowBox[{"visited", ":", " ", 
                    RowBox[{
                    RowBox[{"11.", " ", "Nov", " ", "2021"}], " ", "-", " ", 
                    "3"}], ":", 
                    RowBox[{"28", " ", 
                    RowBox[{"p", ".", "m", "."}]}]}]}], ")"}]}]}]}]}], "*)"}],
                "\[IndentingNewLine]", 
               RowBox[{"data2", "=", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "@", "data"}], ",", "gfpBool"}], 
                  "]"}]}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "create", " ", "a", " ", "simple", " ", "validation", " ", 
                 "image", " ", "by", " ", "overlaying", " ", "the", " ", 
                 "detect", " ", "cells", " ", "and", " ", "the", " ", "GFP", 
                 " ", "image"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"overlayGFP", " ", "=", " ", 
                RowBox[{"ImageCompose", "[", 
                 RowBox[{
                  RowBox[{"ImageMultiply", "[", 
                   RowBox[{
                    RowBox[{"Binarize", "[", 
                    RowBox[{"cellComponentsColored", ",", "0"}], "]"}], ",", 
                    " ", "White", ",", "3.0"}], "]"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"ImageMultiply", "[", 
                    RowBox[{"imgGFP", ",", " ", "Red", ",", " ", "3.0"}], 
                    "]"}], ",", " ", ".5"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Export", "[", 
                RowBox[{
                 RowBox[{
                 "fileName2", "<>", " ", "\"\<_gfp_overlay\>\"", "<>", 
                  "\"\<.jpg\>\""}], ",", "overlayGFP", " ", ",", 
                 "\"\<JPEG\>\"", ",", 
                 RowBox[{"\"\<CompressionLevel\>\"", "\[Rule]", "0"}]}], 
                "]"}], ";"}], "\[IndentingNewLine]", ")"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "placeholder", " ", "added", " ", "to", " ", "the", " ", 
                "data", " ", "table", " ", "if", " ", "the", " ", "GFP", " ", 
                "processing", " ", "is", " ", "not", " ", "executed"}], 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"data2", "=", 
                RowBox[{
                 RowBox[{"Append", "[", "\"\<no GFP data\>\"", "]"}], "/@", 
                 "data"}]}], ";"}], "\[IndentingNewLine]", ")"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           StyleBox[
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Building", " ", "data"}], "-", 
              RowBox[{"table", " ", "part", " ", "1"}]}], "*)"}], 
            "Subsubsection"], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Problem", ":", " ", 
             RowBox[{
             "the", " ", "original", " ", "cell", " ", "objects", " ", "and", 
              " ", "the", " ", "smooth", " ", "cell", " ", "objects", " ", 
              "have", " ", "a", " ", "different", " ", 
              RowBox[{"numbering", ".", " ", "The"}], " ", "called", " ", 
              "helper", " ", "function", " ", "uses", " ", "the", " ", 
              "Medoid", " ", "value", " ", "of", " ", "the", " ", "objects", 
              " ", "and", " ", "matches", " ", "corresponding", " ", 
              "cells"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"sorting1", " ", "=", " ", 
            RowBox[{"componentSorting", "[", 
             RowBox[{
             "data", ",", "dataSmooth", ",", "13", ",", "2", ",", "15"}], 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "combine", " ", "the", " ", "measurements", " ", "of", " ", 
              "the", " ", "corresponding", " ", "components"}], ";", " ", 
             RowBox[{
             "only", " ", "the", " ", "\"\<PolygonalLength\>\"", " ", "value",
               " ", "from", " ", "the", " ", "smooth", " ", "image", " ", 
              "is", " ", "added"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"dataMerged", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"data2", "[", 
                 RowBox[{"[", 
                  RowBox[{"sorting1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
                
                RowBox[{"dataSmooth", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"sorting1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", "3"}], "]"}], 
                 "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", " ", "[", "sorting1", "]"}]}], "}"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
              RowBox[{"compute", " ", "the", " ", "R"}], "-", "index"}], ",", 
             " ", 
             RowBox[{
              RowBox[{
              "the", " ", "essential", " ", "parameter", " ", "in", " ", 
               "the", " ", "ZO"}], "-", 
              RowBox[{"1", " ", 
               RowBox[{"model", ".", " ", "The"}], " ", "difference", " ", 
               "in", " ", "cell", " ", "perimeter", " ", "compared", " ", 
               "is", " ", "a", " ", "marker", " ", "for", " ", "cell", " ", 
               "riffle", " ", "larger", " ", "differences", " ", "mean", " ", 
               "stronger", " ", "riffles"}]}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"rIndex", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "14"}], "]"}], "]"}], "-", 
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "16"}], "]"}], "]"}]}], ")"}], "/", 
                RowBox[{"dataMerged", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "14"}], "]"}], "]"}]}], "*", "100"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", " ", "[", "dataMerged", "]"}]}], "}"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
              RowBox[{"the", " ", "R"}], "-", 
              RowBox[{
              "index", " ", "is", " ", "added", " ", "to", " ", "the", " ", 
               "data", " ", "list"}]}], ",", " ", 
             RowBox[{
             "N", " ", "is", " ", "needed", " ", "to", " ", "get", " ", "rid",
               " ", "of", " ", "the", " ", "fraction"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"dataMerged", "=", 
            RowBox[{"Transpose", "@", 
             RowBox[{"Append", "[", 
              RowBox[{
               RowBox[{"Transpose", "@", "dataMerged"}], ",", 
               RowBox[{"N", "[", "rIndex", "]"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           StyleBox[
            RowBox[{"(*", 
             RowBox[{"Single", " ", "branch", " ", "analysis"}], "*)"}], 
            "Subsubsection"], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"sBranch", "==", "True"}], ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
                RowBox[{
                "the", " ", "single", " ", "branch", " ", "analysis", " ", 
                 "grabs", " ", "the", " ", "skeleton", " ", "image", " ", 
                 "we", " ", "got", " ", "from", " ", "U"}], "-", 
                RowBox[{
                "NET", " ", "and", " ", "divides", " ", "it", " ", "into", 
                 " ", "single", " ", 
                 RowBox[{"parts", ".", " ", "For"}], " ", "each", " ", 
                 "branch", " ", "the", " ", "corresponding", " ", "branch", 
                 " ", "in", " ", "the", " ", "smooth", " ", "skeleton", " ", 
                 "is", " ", 
                 RowBox[{"selected", ".", " ", "Both"}], " ", "perimeters", 
                 " ", "are", " ", "used", " ", "to", " ", "calculate", " ", 
                 "the", " ", "R"}], "-", 
                RowBox[{"index", " ", "of", " ", "this", " ", 
                 RowBox[{"segment", ".", " ", "The"}], " ", "neighbour", " ", 
                 "cell", " ", "objects", " ", "can", " ", "be", " ", "used", 
                 " ", "to", " ", "obtain", " ", "genotype", " ", 
                 "information", " ", "via", " ", "GFP", " ", "signal"}]}], 
               ",", " ", 
               RowBox[{"if", " ", "available"}]}], "*)"}], 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "to", " ", "divide", " ", "our", " ", "initial", " ", 
                "skeleton", " ", "image"}], ",", " ", 
               RowBox[{
               "we", " ", "grab", " ", "the", " ", "skeleton", " ", "and", 
                " ", "all", " ", "branch", " ", 
                RowBox[{"points", ".", " ", "These"}], " ", "are", " ", 
                "enlarged", " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                  "2", " ", "Steps", " ", "necessary", " ", "to", " ", "get", 
                   " ", "them", " ", "big", " ", "enough"}], ")"}], ".", " ", 
                 "It\.b4s"}], " ", "done", " ", "for", " ", "the", " ", 
                "round", " ", "skeleton"}], ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"too", ".", " ", "The"}], " ", "round", " ", 
                 "branches", " ", "can", " ", "vary", " ", "by", " ", "1"}], 
                "-", 
                RowBox[{"2", " ", "pixels"}]}], ",", " ", "so", ",", " ", 
               RowBox[{
               "its", " ", "safer", " ", "to", " ", "use", " ", "both", " ", 
                "and", " ", "add", " ", 
                RowBox[{"them", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"bp", "=", 
               RowBox[{"MorphologicalBranchPoints", "[", 
                RowBox[{"Binarize", "[", "skeleton", "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"bp", "=", 
               RowBox[{"MorphologicalTransform", "[", 
                RowBox[{
                 RowBox[{"MorphologicalTransform", "[", 
                  RowBox[{"bp", ",", "Max"}], "]"}], ",", "Max"}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"bp2", "=", 
               RowBox[{"MorphologicalBranchPoints", "[", 
                RowBox[{"Binarize", "[", "skeleton2", "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"bp2", "=", 
               RowBox[{"MorphologicalTransform", "[", 
                RowBox[{
                 RowBox[{"MorphologicalTransform", "[", 
                  RowBox[{"bp2", ",", "Max"}], "]"}], ",", "Max"}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"bpBoth", "=", 
               RowBox[{"bp", "+", "bp2"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "next", " ", "step", " ", "is", " ", "to", " ", "subtract", 
                 " ", "the", " ", "branch", " ", "points", " ", "from", " ", 
                 "our", " ", "initial", " ", "skeleton", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                   "works", " ", "on", " ", "binarized", " ", "images"}], 
                   ")"}], ".", " ", "All"}], " ", "single", " ", "branches", 
                 " ", "are", " ", "converted", " ", "into", " ", "single", 
                 " ", "components", " ", "and", " ", "colorized", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                   "should", " ", "only", " ", "be", " ", "necessary", " ", 
                    "for", " ", "viewing", " ", "not", " ", "analysis"}], 
                   ")"}], ".", " ", "Only"}], " ", "larger", " ", "branches", 
                 " ", "are", " ", "selected"}], ",", " ", 
                RowBox[{
                "small", " ", "ones", " ", "can", " ", "distract", " ", 
                 "further", " ", "analysis", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"e", ".", "g", ".", " ", "component"}], " ", 
                    "sorting"}], ")"}], ".", " ", "It"}], " ", "done", " ", 
                 "for", " ", "the", " ", "original", " ", "and", " ", "round",
                  " ", "skeleton"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"branchesRiffled", "=", 
               RowBox[{"skeleton", "-", "bpBoth"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"branchesRiffled", "=", 
               RowBox[{
                RowBox[{
                "MorphologicalComponents", "[", "branchesRiffled", "]"}], "//",
                 "Colorize"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"branchesRiffled", "=", 
               RowBox[{"SelectComponents", "[", 
                RowBox[{"branchesRiffled", ",", 
                 RowBox[{
                  RowBox[{"#PerimeterLength", " ", ">", "50"}], "&"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"branchesSmooth", "=", 
               RowBox[{"skeleton2", "-", "bpBoth"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"branchesSmooth", "=", 
               RowBox[{
                RowBox[{
                "MorphologicalComponents", "[", "branchesSmooth", "]"}], "//",
                 "Colorize"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"branchesSmooth", "=", 
               RowBox[{"SelectComponents", "[", 
                RowBox[{"branchesSmooth", ",", 
                 RowBox[{
                  RowBox[{"#PerimeterLength", " ", ">", "50"}], "&"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "the", " ", "relevant", " ", "measurements", " ", "are", " ", 
                RowBox[{"collect", ":", " ", 
                 RowBox[{
                  RowBox[{
                  "Medoid", " ", "is", " ", "later", " ", "used", " ", "for", 
                   " ", "aligning", " ", "round", " ", "and", " ", "riffled", 
                   " ", 
                   RowBox[{"branches", ".", " ", "OuterPerimeterCount"}], " ",
                    "is", " ", "used", " ", "to", " ", "calculate", " ", 
                   "the", " ", "riffle"}], "-", 
                  RowBox[{"Index", " ", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    "seems", " ", "to", " ", "be", " ", "better", " ", "than",
                     " ", "\"\<PolygonalLength\>\"", " ", "on", " ", "the", 
                    " ", "single", " ", "branches"}], ")"}], ".", " ", 
                    "List"}], " ", "associations", " ", "are", " ", 
                   RowBox[{"removed", "."}]}]}]}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"messRiffled", "=", 
               RowBox[{"ComponentMeasurements", "[", 
                RowBox[{"branchesRiffled", ",", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<Medoid\>\"", ",", "\"\<OuterPerimeterCount\>\""}], 
                  "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"messRiffled", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                "messRiffled"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"messSmooth", "=", 
               RowBox[{"ComponentMeasurements", "[", 
                RowBox[{"branchesSmooth", ",", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<Medoid\>\"", ",", "\"\<OuterPerimeterCount\>\""}], 
                  "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"messSmooth", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                "messSmooth"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "convert", " ", "function", " ", "is", " ", "applied", " ", 
                "to", " ", "change", " ", "values", " ", "from", " ", "pixel",
                 " ", "\[Micro]m"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"convertFunction3", "[", 
                RowBox[{"{", 
                 RowBox[{"a_", ",", "b_", ",", "c_"}], "}"}], "]"}], ":=", 
               RowBox[{"{", 
                RowBox[{"a", ",", "b", ",", 
                 RowBox[{"c", "*", "pixelSize"}]}], "}"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"messRiffled", "=", 
               RowBox[{"Map", "[", 
                RowBox[{"convertFunction3", ",", "messRiffled"}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"messSmooth", "=", 
               RowBox[{"Map", "[", 
                RowBox[{"convertFunction3", ",", "messSmooth"}], "]"}]}], ";",
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Problem", ":", " ", 
                RowBox[{
                "the", " ", "riffled", " ", "and", " ", "smooth", " ", 
                 "segment", " ", "have", " ", "a", " ", "different", " ", 
                 RowBox[{"numbering", ".", " ", "The"}], " ", "called", " ", 
                 "helper", " ", "function", " ", "uses", " ", "the", " ", 
                 "Medoid", " ", "value", " ", "of", " ", "the", " ", 
                 "objects", " ", "and", " ", "matches", " ", "corresponding", 
                 " ", 
                 RowBox[{"segments", "/", "branches"}]}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"combinations", "=", 
               RowBox[{"componentSorting", "[", 
                RowBox[{
                "messRiffled", ",", "messSmooth", ",", "2", ",", "2", ",", 
                 "10"}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "construct", " ", "a", " ", "merged", " ", "data", " ", 
                "table", " ", "with", " ", "both", " ", "smooth", " ", "and", 
                " ", "riffled", " ", 
                RowBox[{"OuterPerimeterCount", ".", " ", "Pair"}], " ", "are",
                 " ", "selected", " ", "based", " ", "on", " ", "the", " ", 
                "previous", " ", "calculated", " ", "combinations"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"dataMergedBranches", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"messRiffled", "[", 
                    RowBox[{"[", 
                    RowBox[{"combinations", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
                   
                   RowBox[{"messSmooth", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"combinations", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", "3"}], "]"}], 
                    "]"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", 
                   RowBox[{"Length", " ", "[", "combinations", "]"}]}], 
                  "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                 RowBox[{"compute", " ", "the", " ", "R"}], "-", "index"}], 
                ",", " ", 
                RowBox[{
                "higher", " ", "values", " ", "mean", " ", "larger", " ", 
                 "riffles"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"rIndexSubsegment", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"dataMergedBranches", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "3"}], "]"}], "]"}], "-", 
                    RowBox[{"dataMergedBranches", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "4"}], "]"}], "]"}]}], ")"}], "/", 
                   RowBox[{"dataMergedBranches", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "3"}], "]"}], "]"}]}], "*", "100"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", 
                   RowBox[{"Length", " ", "[", "dataMergedBranches", "]"}]}], 
                  "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                 RowBox[{"the", " ", "R"}], "-", 
                 RowBox[{
                 "index", " ", "is", " ", "added", " ", "to", " ", "the", " ",
                   "data", " ", "list"}]}], ",", " ", 
                RowBox[{
                "N", " ", "is", " ", "needed", " ", "to", " ", "get", " ", 
                 "rid", " ", "of", " ", "the", " ", "fraction"}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"dataMergedBranches", "=", 
               RowBox[{"Transpose", "@", 
                RowBox[{"Append", "[", 
                 RowBox[{
                  RowBox[{"Transpose", "@", "dataMergedBranches"}], ",", 
                  RowBox[{"N", "[", "rIndexSubsegment", "]"}]}], "]"}]}]}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "in", " ", "the", " ", "next", " ", "step", " ", "for", " ", 
                 "each", " ", "segment", " ", "the", " ", "neighbour", " ", 
                 "cell", " ", "objects", " ", "are", " ", 
                 RowBox[{"determined", ".", " ", "We"}], " ", "only", " ", 
                 "want", " ", "to", " ", "use", " ", "segments", " ", "that", 
                 " ", "are", " ", "part", " ", "of", " ", "a", " ", "fully", 
                 " ", "detected", " ", 
                 RowBox[{"cell", ".", " ", "Other"}], " ", "segments", " ", 
                 "might", " ", "be", " ", "incorrectly", " ", "segmented", 
                 " ", "by", " ", "the", " ", "U"}], "-", 
                RowBox[{
                "Net", " ", "and", " ", "could", " ", "potentially", " ", 
                 "vary", " ", "the", " ", "overall", " ", "measurements"}]}], 
               "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"select", " ", "only", " ", "the", " ", "cells"}], 
                ",", " ", 
                RowBox[{
                "that", " ", "are", " ", "present", " ", "in", " ", "the", 
                 " ", "data", " ", 
                 RowBox[{"table", ".", " ", "A"}], " ", "few", " ", "objects",
                  " ", "have", " ", "no", " ", "corresponding", " ", "smooth",
                  " ", "object", " ", "and", " ", "are", " ", "left", " ", 
                 "out", " ", "from", " ", "the", " ", "analysis", " ", "and", 
                 " ", "the", " ", "data", " ", "table", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"see", " ", "componentSorting"}], ")"}], ".", " ", 
                  "The"}], " ", "components", " ", "need", " ", "to", " ", 
                 "converted", " ", "to", " ", "an", " ", "image"}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"selectedCellsImage", " ", "=", 
               RowBox[{"Image", "[", 
                RowBox[{"SelectComponents", "[", 
                 RowBox[{"cellComponents", ",", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "#Label"}], 
                    "]"}], "&"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "search", " ", "for", " ", "the", " ", "neighbour", " ", 
                "cell", " ", "objects", " ", "of", " ", "each", " ", 
                RowBox[{"segment", "/", 
                 RowBox[{"branch", ".", " ", "This"}]}], " ", "is", " ", 
                "done", " ", "with", " ", "another", " ", "helper", " ", 
                "function"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"neighbourNumbers", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"neighbour", "[", 
                  RowBox[{
                   RowBox[{"dataMergedBranches", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
                   "selectedCellsImage"}], " ", "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", 
                   RowBox[{"Length", "[", "dataMergedBranches", "]"}]}], 
                  "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "add", " ", "the", " ", "neighbour", " ", "numbers", " ", "at",
                 " ", "the", " ", "end", " ", "of", " ", "the", " ", "data", 
                " ", "table"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"dataMergedBranches2", "=", 
               RowBox[{"Transpose", "@", 
                RowBox[{"Append", "[", 
                 RowBox[{
                  RowBox[{"Transpose", "@", "dataMergedBranches"}], ",", 
                  "neighbourNumbers"}], "]"}]}]}], ";", "\[IndentingNewLine]",
               "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "only", " ", "keep", " ", "branches", " ", "in", " ", "the", 
                " ", "data", " ", "table", " ", "that", " ", "have", " ", 
                "contact", " ", "to", " ", "1", " ", "or", " ", "2", " ", 
                "cell", " ", "objects"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"dataMergedBranches3", " ", "=", " ", 
               RowBox[{"Select", "[", 
                RowBox[{"dataMergedBranches2", ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], ">", "0"}], 
                  "&"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "When", " ", "GFP", " ", "and", " ", "single", " ", "branch", 
              " ", "processing", " ", "is", " ", "selected"}], ",", " ", 
             RowBox[{
             "both", " ", "in", " ", "the", " ", "previous", " ", "steps", 
              " ", "acquired", " ", "information", " ", "can", " ", "be", " ", 
              RowBox[{"combined", ".", " ", "For"}], " ", "each", " ", 
              "branch", " ", "the", " ", "GFP", " ", "status", " ", "of", " ",
               "the", " ", "neighbour", " ", "cells", " ", "can", " ", "be", 
              " ", 
              RowBox[{"determined", ".", " ", "With"}], " ", "an", " ", 
              "additional", " ", "helper", " ", "function", " ", "it\.b4s", 
              " ", "analysed", " ", "if", " ", "the", " ", "cell", " ", 
              "border", " ", "segmented", " ", "bulges", " ", "to", " ", 
              "one", " ", "of", " ", "the", " ", "neighbour", " ", "cells", 
              " ", "and", " ", "if", " ", "this", " ", "cell", " ", "is", " ",
               "GFP", " ", "positive", " ", "or", " ", 
              RowBox[{"negative", ".", " ", "This"}], " ", "can", " ", "help",
               " ", "analyse", " ", "the", " ", "impact", " ", "of", " ", 
              "different", " ", "genotypes", " ", "on", " ", "the", " ", 
              RowBox[{"cytoskeleton", "."}]}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"gfp", "\[Equal]", " ", "True"}], " ", "&&", " ", 
              RowBox[{"sBranch", "\[Equal]", "True"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "if", " ", "we", " ", "have", " ", "GFP", " ", 
                 "information"}], ",", " ", 
                RowBox[{
                "we", " ", "can", " ", "lookup", " ", "if", " ", "the", " ", 
                 "neighbour", " ", "cell", " ", "for", " ", "each", " ", 
                 "branch", " ", "is", " ", "GFP", " ", "true", " ", "or", " ", 
                 RowBox[{"false", ".", " ", "First"}], " ", "a", " ", 
                 "association", " ", "list", " ", "is", " ", "build", " ", 
                 "that", " ", "contains", " ", "the", " ", "GFP", " ", 
                 "status", " ", "for", " ", "each", " ", "cell", " ", 
                 "number"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"cellGenotype", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "\[Rule]", 
                   RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "15"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "dataMerged", "]"}]}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "with", " ", "the", " ", "association", " ", "list", " ", 
                  "the", " ", "cell"}], "-", "neighbour", "-", 
                 RowBox[{
                 "numbers", " ", "of", " ", "each", " ", "branch", " ", "are",
                   " ", "converted", " ", "to", " ", "GFP", " ", 
                  RowBox[{"true", "/", "false"}]}]}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"cellGenotype", "=", 
                RowBox[{
                 RowBox[{"dataMergedBranches3", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "6"}], "]"}], "]"}], " ", "/.", " ", 
                 "cellGenotype"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "this", " ", "information", " ", "is", " ", "added", " ", 
                 "to", " ", "the", " ", "data", " ", "table"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"dataMergedBranches4", "=", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "@", "dataMergedBranches3"}], ",", 
                   "cellGenotype"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{
                 "The", " ", "branchAnalysisGFP", " ", "helper", " ", 
                  "function", " ", "needs", " ", "two", " ", "images"}], ",", 
                 " ", 
                 RowBox[{
                 "one", " ", "showing", " ", "only", " ", "the", " ", "GFP", 
                  " ", "positive", " ", "cells"}], ",", " ", 
                 RowBox[{
                 "the", " ", "other", " ", "showing", " ", "the", " ", "GFP", 
                  " ", "negative", " ", 
                  RowBox[{"cells", ".", " ", "Both"}], " ", "images", " ", 
                  "are", " ", "binarized"}]}], "*)"}], "\[IndentingNewLine]", 
               
               RowBox[{"imageGFP", "=", 
                RowBox[{"Image", "[", 
                 RowBox[{"SelectComponents", "[", 
                  RowBox[{"cellComponents", ",", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"Map", "[", 
                    RowBox[{"First", ",", 
                    RowBox[{"Select", "[", 
                    RowBox[{"dataMerged", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "15", "]"}], "]"}], "\[Equal]", "True"}], 
                    "&"}]}], "]"}]}], "]"}], ",", "#Label"}], "]"}], "&"}]}], 
                  "]"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
               RowBox[{"imageNon", "=", 
                RowBox[{"Image", "[", 
                 RowBox[{"SelectComponents", "[", 
                  RowBox[{"cellComponents", ",", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"Map", "[", 
                    RowBox[{"First", ",", 
                    RowBox[{"Select", "[", 
                    RowBox[{"dataMerged", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "15", "]"}], "]"}], "\[Equal]", "False"}], 
                    "&"}]}], "]"}]}], "]"}], ",", "#Label"}], "]"}], "&"}]}], 
                  "]"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
               RowBox[{"imageGFP", "=", 
                RowBox[{"Binarize", "[", 
                 RowBox[{"imageGFP", ",", "0.01"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"imageNon", "=", 
                RowBox[{"Binarize", "[", 
                 RowBox[{"imageNon", ",", "0.01"}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "call", " ", "the", " ", "helper", " ", "function", " ", 
                 "that", " ", "can", " ", "retrieve", " ", "information", " ",
                  "about", " ", "the", " ", "bulging", " ", "of", " ", "the", 
                 " ", 
                 RowBox[{"branch", "/", "cell"}], " ", "border", " ", 
                 RowBox[{"segment", "."}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"fiberDataAdvanced", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"branchAnalysisGFP", "[", 
                   RowBox[{
                   "i", ",", "dataMerged", ",", "dataMergedBranches4", ",", 
                    "branchesRiffled", ",", "selectedCellsImage", ",", 
                    "imageGFP", ",", "imageNon"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "dataMergedBranches4", "]"}]}], 
                   "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "add", " ", "the", " ", "newly", " ", "computed", " ", 
                  "measurements", " ", "to", " ", "the", " ", "data", " ", 
                  RowBox[{
                  "table", ":", " ", 
                   "\"\<branch orientation based on the Centroid \
value\>\""}]}], ",", "\"\<branch enclosed area\>\"", ",", " ", 
                 RowBox[{"\"\<pulled area\>\"", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"when", " ", 
                    RowBox[{"positive", ":", " ", 
                    RowBox[{
                    RowBox[{"pulled", " ", "to", " ", "the", " ", "GFP"}], 
                    "+", " ", "cell"}]}]}], ",", " ", 
                    RowBox[{
                    "when", " ", "negative", " ", "pull", " ", "to", " ", 
                    "GFP", " ", "negative", " ", "cell"}]}]}]}]}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"dataMergedBranches4", "=", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "@", "dataMergedBranches4"}], ",", 
                   RowBox[{"fiberDataAdvanced", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}]}], ";",
                "\[IndentingNewLine]", 
               RowBox[{"dataMergedBranches4", "=", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "@", "dataMergedBranches4"}], ",", 
                   RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"fiberDataAdvanced", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0.01"}], 
                    "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"dataMergedBranches4", "=", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "@", "dataMergedBranches4"}], ",", 
                   RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"fiberDataAdvanced", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", "0.01"}], 
                    "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"additionally", ",", " ", 
                 RowBox[{
                 "we", " ", "can", " ", "select", " ", "all", " ", 
                  "branches"}], ",", " ", 
                 RowBox[{
                  RowBox[{
                  "that", " ", "are", " ", "corresponding", " ", "to", " ", 
                   "one", " ", "cell", " ", 
                   RowBox[{"object", ".", " ", "The"}], " ", "R"}], "-", 
                  RowBox[{
                  "indices", " ", "of", " ", "all", " ", "branches", " ", 
                   "of", " ", "each", " ", "cell", " ", "are", " ", "added", 
                   " ", "to", " ", "the", " ", "main", " ", "data"}], "-", 
                  "table"}], ",", " ", 
                 RowBox[{
                 "values", " ", "are", " ", "rounded", " ", "and", " ", "the",
                   " ", "list", " ", "is", " ", "converted", " ", "into", " ",
                   "a", " ", "string", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    "in", " ", "excel", " ", "lists", " ", "of", " ", 
                    "values", " ", "are", " ", "already", " ", "saved", " ", 
                    "as", " ", "a", " ", "string"}], " ", "-", " ", 
                    RowBox[{
                    "converting", " ", "at", " ", "this", " ", "point", " ", 
                    "in", " ", "the", " ", "script", " ", "might", " ", 
                    "prevent", " ", "formatting", " ", "errors"}]}]}]}]}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"dataMerged", "=", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "@", "dataMerged"}], ",", 
                   RowBox[{"Map", "[", 
                    RowBox[{"ToString", ",", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"backSorting", "[", 
                    RowBox[{
                    RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
                    "dataMergedBranches4"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "dataMerged", "]"}]}], "}"}]}], 
                    "]"}], ",", "0.01"}], "]"}]}], "]"}]}], "]"}]}]}], ";"}], 
              "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"gfp", "\[Equal]", " ", "False"}], " ", "&&", " ", 
              RowBox[{"sBranch", "\[Equal]", "True"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "when", " ", "the", " ", "additional", " ", "GFP", " ", 
                 "file", " ", "does", " ", "not", " ", "exist"}], ",", " ", 
                RowBox[{
                "a", " ", "placeholder", " ", "is", " ", "added", " ", "to", 
                 " ", "the", " ", "single", " ", "branch", " ", "data", " ", 
                 "table"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"dataMergedBranches4", "=", 
                RowBox[{
                 RowBox[{"Append", "[", "\"\<No GFP\>\"", "]"}], "/@", 
                 "dataMergedBranches3"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                  RowBox[{"all", " ", 
                   RowBox[{"branches", "/", "segments"}], " ", "being", " ", 
                   "part", " ", "of", " ", "one", " ", "cell", " ", "can", 
                   " ", "be", " ", "selected", " ", "and", " ", "the", " ", 
                   "R"}], "-", 
                  RowBox[{
                  "indices", " ", "are", " ", "added", " ", "to", " ", "the", 
                   " ", "main", " ", "data"}], "-", "table"}], ",", " ", 
                 RowBox[{
                 "values", " ", "are", " ", "rounded", " ", "and", " ", "the",
                   " ", "list", " ", "is", " ", "converted", " ", "into", " ",
                   "a", " ", "string", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    "in", " ", "excel", " ", "lists", " ", "of", " ", 
                    "values", " ", "are", " ", "already", " ", "saved", " ", 
                    "as", " ", "a", " ", "string"}], " ", "-", " ", 
                    RowBox[{
                    "converting", " ", "at", " ", "this", " ", "point", " ", 
                    "in", " ", "the", " ", "script", " ", "might", " ", 
                    "prevent", " ", "formatting", " ", "errors"}]}]}]}]}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"dataMerged", "=", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "@", "dataMerged"}], ",", 
                   RowBox[{"Map", "[", 
                    RowBox[{"ToString", ",", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"backSorting", "[", 
                    RowBox[{
                    RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
                    "dataMergedBranches4"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "dataMerged", "]"}]}], "}"}]}], 
                    "]"}], ",", "0.01"}], "]"}]}], "]"}]}], "]"}]}]}], ";"}], 
              "\[IndentingNewLine]", ")"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           StyleBox[
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Building", " ", "data"}], "-", 
              RowBox[{"table", " ", "part", " ", "2"}]}], "*)"}], 
            "Subsubsection"], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "round", " ", "the", " ", "values", " ", "to", " ", "generate", 
             " ", "a", " ", "nicer", " ", "view", " ", "in", " ", "the", " ", 
             "excel", " ", "file", " ", 
             RowBox[{"(", 
              RowBox[{
              "more", " ", "accuracy", " ", "is", " ", "not", " ", "needed"}],
               ")"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dataMerged", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "=", 
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"dataMerged", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], ",", "0.01"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dataMerged", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "4"}], "]"}], "]"}], "=", 
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"dataMerged", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "4"}], "]"}], "]"}], ",", "0.001"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dataMerged", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"5", ";;", "9"}]}], "]"}], "]"}], "=", 
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"dataMerged", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"5", ";;", "9"}]}], "]"}], "]"}], ",", "0.01"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dataMerged", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"10", ";;", "12"}]}], "]"}], "]"}], "=", 
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"dataMerged", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"10", ";;", "12"}]}], "]"}], "]"}], ",", "0.001"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dataMerged", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "14"}], "]"}], "]"}], "=", 
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"dataMerged", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "14"}], "]"}], "]"}], ",", "0.01"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dataMerged", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"16", ";;", "17"}]}], "]"}], "]"}], "=", 
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"dataMerged", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"16", ";;", "17"}]}], "]"}], "]"}], ",", "0.01"}], 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "create", " ", "a", " ", "summary", " ", "line", " ", "that", 
              " ", "will", " ", "be", " ", "part", " ", "of", " ", "the", " ",
               "exported", " ", "excel", " ", 
              RowBox[{"file", ".", " ", "Total"}], " ", "cell", " ", "count", 
              " ", "is", " ", "added", " ", "at", " ", "the", " ", "begin", 
              " ", "of", " ", "the", " ", "list"}], ",", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
               "followed", " ", "by", " ", "the", " ", "mean", " ", "values", 
                " ", "of", " ", "the", " ", 
                RowBox[{"parameters", ".", " ", "For"}], " ", "a", " ", "few",
                 " ", "parameters", " ", "mean", " ", "values", " ", 
                "can\.b4t", " ", "be", " ", 
                RowBox[{"computed", " ", "--"}]}], ">", " ", 
               RowBox[{"a", " ", "placeholder", " ", "is", " ", "added"}]}], 
              ";", " ", "again"}], ",", " ", 
             RowBox[{
             "Round", " ", "added", " ", "for", " ", "a", " ", "nicer", " ", 
              "view", " ", "of", " ", "the", " ", "results", " ", "in", " ", 
              "the", " ", "excel", " ", "file"}]}], "*)"}], "   ", 
           "\[IndentingNewLine]", 
           RowBox[{"datacal1", " ", "=", " ", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"List", "[", 
               RowBox[{"Length", "[", "dataMerged", "]"}], "]"}], ",", 
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{"Mean", "[", 
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "]"}], "]"}], 
                ",", "0.01"}], "]"}], ",", 
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{"Mean", "[", 
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"4", ";;", "4"}]}], "]"}], "]"}], "]"}], "]"}], 
                ",", "0.001"}], "]"}], ",", 
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{"Mean", "[", 
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"5", ";;", "9"}]}], "]"}], "]"}], "]"}], "]"}], 
                ",", "0.01"}], "]"}], ",", 
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{"Mean", "[", 
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"10", ";;", "12"}]}], "]"}], "]"}], "]"}], "]"}], 
                ",", "0.001"}], "]"}], ",", 
              RowBox[{"List", "[", "\"\<NULL\>\"", "]"}], ",", 
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{"Mean", "[", 
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"14", ";;", "14"}]}], "]"}], "]"}], "]"}], "]"}], 
                ",", "0.01"}], "]"}], ",", 
              RowBox[{"List", "[", "\"\<NULL\>\"", "]"}], ",", 
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{"Mean", "[", 
                  RowBox[{"dataMerged", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"16", ";;", "17"}]}], "]"}], "]"}], "]"}], "]"}], 
                ",", "0.01"}], "]"}], ",", 
              RowBox[{"List", "[", "\"\<NULL\>\"", "]"}]}], " ", "]"}]}], ";",
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "header", " ", "and", " ", "subhead", " ", "text", " ", "for", 
             " ", "the", " ", "export", " ", "file"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"head1", "=", 
            RowBox[{"{", 
             RowBox[{
             "\"\<cell number\>\"", ",", "\"\<area [\[Micro]m\.b2]\>\"", ",", 
              "\"\<equivalentDiskRadius [\[Micro]m]\>\"", ",", 
              "\"\<areaRadiusCoverage\>\"", ",", 
              "\"\<authalicRadius [\[Micro]m]\>\"", ",", 
              "\"\<outerPerimeterCount [\[Micro]m]\>\"", ",", 
              "\"\<perimeterLength [\[Micro]m]\>\"", ",", 
              "\"\<meanCentroidDistance [\[Micro]m]\>\"", ",", 
              "\"\<maxCentroidDistance [\[Micro]m]\>\"", ",", 
              "\"\<minCentroidDistance [\[Micro]m]\>\"", ",", 
              "\"\<filledCircularity\>\"", ",", "\"\<rectangularity\>\"", 
              ",", "\"\<medoid\>\"", ",", 
              "\"\<polygonalLength [\[Micro]m]\>\"", ",", "\"\<GFP\>\"", ",", 
              "\"\<polygonalLength smooth [\[Micro]m]\>\"", ",", " ", 
              "\"\<R-index\>\"", ",", " ", "\"\<single branch R-Index\>\""}], 
             "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"subhead", "=", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\"\<aggregated data - mean values\>\"", "}"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\"\<single cell data\>\"", "}"}]}], 
             "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
           StyleBox["\[IndentingNewLine]", "Section"], 
           StyleBox[
            RowBox[{"(*", 
             RowBox[{
             "merges", " ", "the", " ", "final", " ", "output", " ", 
              "table"}], "*)"}], "Input"], "\[IndentingNewLine]", 
           RowBox[{"tableData1", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "head1", "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"subhead", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", "datacal1", "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"subhead", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "}"}], ",", "dataMerged"}], 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "When", " ", "the", " ", "single", " ", "branch", " ", "setting", 
             " ", "is", " ", "used", " ", "a", " ", "second", " ", "export", 
             " ", "table", " ", "is", " ", "build"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"sBranch", "\[Equal]", "True"}], " ", ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "round", " ", "the", " ", "values", " ", "to", " ", "generate", 
               " ", "a", " ", "nicer", " ", "view", " ", "in", " ", "the", 
               " ", "excel", " ", "file", " ", 
               RowBox[{"(", 
                RowBox[{
                "more", " ", "accuracy", " ", "is", " ", "not", " ", 
                 "needed"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"dataMergedBranches4", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", 
                  RowBox[{"3", ";;", "5"}]}], "]"}], "]"}], "=", 
               RowBox[{"Round", "[", 
                RowBox[{
                 RowBox[{"dataMergedBranches4", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", 
                    RowBox[{"3", ";;", "5"}]}], "]"}], "]"}], ",", "0.01"}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "create", " ", "the", " ", "summary", " ", "line", " ", 
                 "that", " ", "will", " ", "be", " ", "part", " ", "of", " ", 
                 "the", " ", "exported", " ", "excel", " ", 
                 RowBox[{"file", ".", " ", "Total"}], " ", "number", " ", 
                 "of", " ", "segments", " ", "is", " ", "added", " ", "at", 
                 " ", "the", " ", "begin", " ", "of", " ", "the", " ", 
                 "list"}], ",", " ", 
                RowBox[{
                 RowBox[{
                 "followed", " ", "by", " ", "the", " ", "mean", " ", 
                  "values", " ", "of", " ", "the", " ", 
                  RowBox[{"parameters", ".", " ", "For"}], " ", "a", " ", 
                  "few", " ", "parameters", " ", "mean", " ", "values", " ", 
                  "can\.b4t", " ", "be", " ", 
                  RowBox[{"computed", " ", "--"}]}], ">", " ", 
                 RowBox[{
                 "a", " ", "placeholder", " ", "is", " ", "added"}]}]}], 
               "*)"}], "   ", "\[IndentingNewLine]", 
              RowBox[{"datacal2", " ", "=", " ", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"List", "[", 
                  RowBox[{"Length", "[", "dataMergedBranches4", "]"}], "]"}], 
                 ",", 
                 RowBox[{"List", "[", "\"\<NULL\>\"", "]"}], ",", 
                 RowBox[{"Round", "[", 
                  RowBox[{
                   RowBox[{"N", "[", 
                    RowBox[{"Mean", "[", 
                    RowBox[{"dataMergedBranches4", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"3", ";;", "5"}]}], "]"}], "]"}], "]"}], "]"}], 
                   ",", "0.01"}], "]"}], ",", 
                 RowBox[{"List", "[", "\"\<NULL\>\"", "]"}], ",", 
                 RowBox[{"List", "[", "\"\<NULL\>\"", "]"}]}], " ", "]"}]}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "define", " ", "header", " ", "for", " ", "the", " ", "export",
                 " ", "file"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"head2", "=", 
               RowBox[{"{", 
                RowBox[{
                "\"\<branch number\>\"", ",", "\"\<medoid\>\"", ",", 
                 "\"\<outerPerimeterCount [\[Micro]m]\>\"", ",", " ", 
                 "\"\<outerPerimeterCount smooth [\[Micro]m]\>\"", ",", 
                 "\"\<R-index\>\"", ",", "\"\<neighbour cell number\>\"", ",",
                  " ", "\"\<GFP neighbour cell\>\"", ",", 
                 "\"\<branch orientation\>\"", ",", 
                 "\"\<branch enclosed area [\[Micro]m\.b2]\>\"", ",", 
                 "\"\<pulled area [\[Micro]m\.b2]\>\""}], "}"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              StyleBox[
               RowBox[{"(*", 
                RowBox[{
                "merges", " ", "the", " ", "final", " ", "output", " ", 
                 "table"}], "*)"}], "Input"], "\[IndentingNewLine]", 
              RowBox[{"tableData2", "=", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", "head2", "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"subhead", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
                 RowBox[{"{", "datacal2", "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"subhead", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "}"}], ",", 
                 "dataMergedBranches4"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           StyleBox[
            RowBox[{"(*", 
             RowBox[{"Form", " ", "analysis"}], "*)"}], "Subsubsection"], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"formAnalysis", "\[Equal]", "True"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "a", " ", "few", " ", "essential", " ", "measurements", " ", 
                 "for", " ", "each", " ", "object", " ", "are", " ", 
                 RowBox[{"determined", ".", " ", "The"}], " ", 
                 "\"\<map2\>\""}], "-", 
                RowBox[{"image", " ", 
                 RowBox[{"(", 
                  RowBox[{"matrix", " ", "form"}], ")"}], " ", "and", " ", 
                 "NOT", " ", "the", " ", "coloured", " ", "image", " ", "is", 
                 " ", "used"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"measure", " ", "=", " ", 
                RowBox[{"ComponentMeasurements", "[", 
                 RowBox[{"cellComponents", ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "\"\<Area\>\"", ",", "\"\<Orientation\>\"", ",", 
                    "\"\<Length\>\"", ",", "\"\<Centroid\>\""}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "remove", " ", "associations", " ", "in", " ", "the", " ", 
                 "measure", " ", "list"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"measure", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                 "measure"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                  RowBox[{"the", " ", "orientation"}], "-", 
                  RowBox[{
                  "values", " ", "are", " ", "radian", " ", "and", " ", 
                   "need", " ", "to", " ", "be", " ", "converted", " ", "to", 
                   " ", "degrees", " ", "values", " ", "for", " ", "the", " ",
                    "later", " ", "processing", " ", 
                   RowBox[{
                    RowBox[{"steps", "."}], " ", "/", "Degree"}], " ", 
                   "converts", " ", "the", " ", "radian", " ", "values"}]}], 
                 ",", " ", 
                 RowBox[{
                 "Mod", " ", "180", " ", "converts", " ", "all", " ", 
                  "negatives", " ", "values", " ", "and", " ", "values", " ", 
                  "greater", " ", "180", "\[Degree]", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "we", " ", "only", " ", "want", " ", "values", " ", 
                    "between", " ", "0", " ", "and", " ", "179"}], ",", 
                    "99"}], ")"}], ".", " ", "The"}], " ", "original", " ", 
                  "values", " ", "are", " ", "replaced", " ", "in", " ", 
                  "the", " ", "measure", " ", "array"}]}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"measure", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", "=", "  ", 
                RowBox[{"Mod", "[", 
                 RowBox[{
                  RowBox[{"Round", "[", 
                   RowBox[{
                    RowBox[{"measure", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "3"}], "]"}], "]"}], "/", "Degree"}], 
                   "]"}], ",", "180"}], "]"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "each", " ", "cell", " ", "object", " ", "is", " ", "rotated",
                  " ", "and", " ", "packed", " ", "into", " ", "a", " ", 
                 "SparseArray", " ", 
                 RowBox[{"(", 
                  RowBox[{
                  "image", " ", "data", " ", "in", " ", "matrix", " ", 
                   "form"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"singleObjectMatrix", "=", " ", 
                RowBox[{"SparseArray", "[", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"rotateCrop", "[", 
                    RowBox[{"i", ",", "cellComponents", ",", "measure"}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "measure", "]"}]}], "}"}]}], "]"}],
                  "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               
               RowBox[{"(*", 
                RowBox[{
                "for", " ", "simple", " ", "visualisation", " ", "all", " ", 
                 "cells", " ", "are", " ", "overlayed", " ", "at", " ", "the",
                  " ", "centre", " ", 
                 RowBox[{"point", ".", " ", "A"}], " ", "heatmap", " ", 
                 "colouring", " ", "shows", " ", "the", " ", "overlapping", 
                 " ", "parts"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"singleObjectColored", "=", 
                RowBox[{"ImageResize", "[", 
                 RowBox[{
                  RowBox[{"changeColour", "[", 
                   RowBox[{"Total", "[", "singleObjectMatrix", "]"}], "]"}], 
                  ",", 
                  RowBox[{"Scaled", "[", "3", "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "export", " ", "the", " ", "matrix", " ", "file", " ", "and", 
                 " ", "visualisation"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Export", "[", 
                RowBox[{
                 RowBox[{
                 "fileName3", "<>", " ", "\"\<_raw-matrix_fullcell\>\"", 
                  "<>", "\"\<.mat\>\""}], ",", "singleObjectMatrix", ",", 
                 "\"\<MAT\>\""}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Export", "[", 
                RowBox[{
                 RowBox[{
                 "fileName1", "<>", " ", "\"\<_form_analysis_fullcell\>\"", 
                  "<>", "\"\<.jpg\>\""}], ",", "singleObjectColored", ",", 
                 "\"\<JPEG\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
              ")"}]}], "\[IndentingNewLine]", "]"}], ";", 
           StyleBox["\[IndentingNewLine]", "Subsubsection"], 
           "\[IndentingNewLine]", 
           StyleBox[
            RowBox[{"(*", 
             RowBox[{"Export", " ", "and", " ", "overlay", " ", "creation"}], 
             "*)"}], "Subsubsection"], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "overlays", " ", "the", " ", "riffled", " ", "and", " ", "round",
               " ", "skeleton"}], ";", " ", 
             RowBox[{
             "use", " ", "ColorNegate", " ", "to", " ", "archive", " ", "a", 
              " ", "black", " ", "background"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"overlayRiffleRound", "=", 
            RowBox[{"ImageCompose", "[", 
             RowBox[{
              RowBox[{"ImageMultiply", "[", 
               RowBox[{"skeleton", ",", "White", ",", "3.0"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"ImageMultiply", "[", 
                 RowBox[{"skeleton2", ",", "Red", ",", "3.0"}], "]"}], ",", 
                ".5"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "overlays", " ", "the", " ", "detected", " ", "cells", " ", 
              "and", " ", "their", " ", "corresponding", " ", "riffle"}], "-",
              "index"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"overlayRIndex", " ", "=", 
            RowBox[{"Show", "[", 
             RowBox[{
              RowBox[{"Image", "[", "cellComponentsColored", "]"}], ",", 
              RowBox[{"Graphics", "[", 
               RowBox[{"{", 
                RowBox[{"White", ",", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Inset", "[", 
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "17"}], "]"}], "]"}], ",", "0.1"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "13"}], "]"}], "]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "dataMerged", "]"}]}], "}"}]}], 
                  "]"}]}], "}"}], "]"}], ",", 
              RowBox[{"ImageSize", "\[Rule]", " ", 
               RowBox[{
               "ImageDimensions", "[", "cellComponentsColored", "]"}]}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"export", " ", "functions", " ", "for", " ", "table"}], 
             "-", 
             RowBox[{"data", " ", "and", " ", 
              RowBox[{"(", 
               RowBox[{"overlay", "-"}], ")"}], "images"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"Export", "[", 
            RowBox[{
             RowBox[{"fileName3", "<>", "\"\<_zo1.xlsx\>\""}], ",", 
             "tableData1", ",", "\"\<XLSX\>\""}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Export", "[", 
            RowBox[{
             RowBox[{
             "fileName1", "<>", " ", "\"\<_original\>\"", "<>", 
              "\"\<.jpg\>\""}], ",", "overlayRIndex", ",", "\"\<JPEG\>\"", 
             ",", 
             RowBox[{"\"\<CompressionLevel\>\"", "\[Rule]", "0"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"Export", "[", 
            RowBox[{
             RowBox[{
             "fileName1", "<>", " ", "\"\<_round\>\"", "<>", "\"\<.jpg\>\""}],
              ",", "cellComponentsSmoothColored", ",", "\"\<JPEG\>\"", ",", 
             RowBox[{"\"\<CompressionLevel\>\"", "\[Rule]", "0"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"Export", "[", 
            RowBox[{
             RowBox[{
             "fileName2", "<>", " ", "\"\<_overlay_riffle_round\>\"", "<>", 
              "\"\<.jpg\>\""}], ",", "overlayRiffleRound", ",", 
             "\"\<JPEG\>\"", ",", 
             RowBox[{"\"\<CompressionLevel\>\"", "\[Rule]", "0"}]}], "]"}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"sBranch", " ", "\[Equal]", "True"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "this", " ", "overlay", " ", "is", " ", "used", " ", "below", 
               " ", "for", " ", 
               RowBox[{"overlaySingleBranch", ".", " ", "It"}], " ", 
               "overlays", " ", "the", " ", "detected", " ", "cells", " ", 
               "with", " ", "their", " ", "corresponding", " ", "cell", " ", 
               "number"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"overlayCellNumbers", " ", "=", 
               RowBox[{"Show", "[", 
                RowBox[{"cellComponentsColored", ",", 
                 RowBox[{"Graphics", "[", 
                  RowBox[{"{", 
                   RowBox[{"White", ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Inset", "[", 
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"dataMerged", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "13"}], "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "dataMerged", "]"}]}], "}"}]}], 
                    "]"}]}], "}"}], "]"}], ",", 
                 RowBox[{"ImageSize", "\[Rule]", " ", 
                  RowBox[{
                  "ImageDimensions", "[", "cellComponentsColored", "]"}]}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "this", " ", "image", " ", "is", " ", "used", " ", "below", 
                " ", "for", " ", 
                RowBox[{"overlaySingleBranch", ".", " ", "It"}], " ", "shows",
                 " ", "only", " ", "the", " ", "branches", " ", "that", " ", 
                "we", " ", "finally", " ", "selected", " ", "for", " ", 
                "measurements"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"branchesRiffledSelected", "=", 
               RowBox[{"SelectComponents", "[", 
                RowBox[{"branchesRiffled", ",", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{
                    RowBox[{"dataMergedBranches4", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "#Label"}], 
                   "]"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "overlays", " ", "the", " ", "2", " ", "previous", " ", 
                 "images", " ", "and", " ", "shows", " ", "the", " ", "R"}], 
                "-", 
                RowBox[{"index", " ", "for", " ", "each", " ", "branch"}]}], 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"overlaySingleBranch", "=", 
               RowBox[{"Show", "[", 
                RowBox[{
                 RowBox[{"ImageCompose", "[", 
                  RowBox[{"overlayCellNumbers", ",", 
                   RowBox[{"ColorReplace", "[", 
                    RowBox[{"branchesRiffledSelected", ",", 
                    RowBox[{"Black", "\[Rule]", "Transparent"}]}], "]"}]}], 
                  "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Graphics", "[", 
                    RowBox[{"{", 
                    RowBox[{"White", ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Inset", "[", 
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"Round", "[", 
                    RowBox[{
                    RowBox[{"dataMergedBranches4", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "5"}], "]"}], "]"}], ",", "0.1"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"dataMergedBranches4", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "dataMergedBranches4", "]"}]}], 
                    "}"}]}], "]"}]}], "}"}], "]"}], "ImageSize"}], "\[Rule]", 
                  " ", 
                  RowBox[{
                  "ImageDimensions", "[", "overlayCellNumbers", "]"}]}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "export", " ", "the", " ", "overlay", " ", "and", " ", 
                "result", " ", "table"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"Export", "[", 
               RowBox[{
                RowBox[{
                "fileName3", "<>", " ", "\"\<_branches\>\"", "<>", 
                 "\"\<.xlsx\>\""}], ",", "tableData2", ",", "\"\<XLSX\>\""}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Export", "[", 
               RowBox[{
                RowBox[{
                "fileName2", "<>", " ", "\"\<_single_branch\>\"", "<>", 
                 "\"\<.jpg\>\""}], ",", "overlaySingleBranch", ",", 
                "\"\<JPEG\>\"", ",", 
                RowBox[{"\"\<CompressionLevel\>\"", "\[Rule]", "0"}]}], "]"}],
               ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", ")"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "if", " ", "no", " ", "cells", " ", "are", " ", "detected", " ", 
             "in", " ", "the", " ", "image"}], ",", " ", 
            RowBox[{
            "a", " ", "text", " ", "file", " ", "is", " ", "saved", " ", "so",
              " ", "that", " ", "faulty", " ", "images", " ", "can", " ", 
             "be", " ", "easily", " ", "spotted", " ", "in", " ", "the", " ", 
             "output", " ", "folder"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "failure", "=", "\"\<No detectable cells in this Image\>\""}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"Export", "[", 
            RowBox[{
             RowBox[{"fileName3", "<>", "\"\<_zo1.txt\>\""}], ",", "failure", 
             ",", "\"\<Text\>\""}], "]"}], ";"}], " ", "\[IndentingNewLine]", 
          ")"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782774295518*^9}, {3.7403908710152287`*^9, 
   3.740390904306226*^9}, 3.740391508989131*^9, 3.74039154850494*^9, {
   3.743432314264383*^9, 3.74343234587469*^9}, {3.7437487525435*^9, 
   3.743748780185173*^9}, {3.7437488225563507`*^9, 3.7437489572381835`*^9}, {
   3.7437515811383505`*^9, 3.7437517047623353`*^9}, {3.7437538598746605`*^9, 
   3.7437538850105295`*^9}, {3.74495773545614*^9, 3.744957761353165*^9}, {
   3.74495787718661*^9, 3.744957888705905*^9}, {3.745224764657011*^9, 
   3.745224814226226*^9}, 3.745224904207001*^9, {3.745225006816019*^9, 
   3.7452250313041306`*^9}, {3.745225095000407*^9, 3.74522513789783*^9}, {
   3.7452293149515743`*^9, 3.7452293174362354`*^9}, 3.7613144633519855`*^9, {
   3.7613145111380787`*^9, 3.7613145113580422`*^9}, {3.7613146448581104`*^9, 
   3.7613146742781296`*^9}, {3.761314704438197*^9, 3.761314734458376*^9}, {
   3.7613147718883686`*^9, 3.761314840438471*^9}, {3.7613161196123266`*^9, 
   3.7613161294731083`*^9}, {3.761316744744779*^9, 3.761316752371785*^9}, {
   3.7613171703726344`*^9, 3.761317188395846*^9}, {3.7613175042850943`*^9, 
   3.761317506452593*^9}, {3.7613858146167*^9, 3.7613859523958845`*^9}, {
   3.7613955938867865`*^9, 3.761395603240579*^9}, {3.7617510945982056`*^9, 
   3.76175148235588*^9}, {3.761751520197472*^9, 3.761751532683305*^9}, {
   3.7617517246662273`*^9, 3.76175172514545*^9}, {3.761751888298921*^9, 
   3.7617519124491277`*^9}, {3.7617519446385975`*^9, 3.761751962952301*^9}, {
   3.7617523170163736`*^9, 3.7617524152599597`*^9}, 3.7617525540594535`*^9, {
   3.7617526860752983`*^9, 3.7617526897392435`*^9}, {3.761763205785245*^9, 
   3.7617632173637114`*^9}, {3.761990630304537*^9, 3.761990694826851*^9}, {
   3.7619907258239098`*^9, 3.7619907308033113`*^9}, {3.761996317507848*^9, 
   3.761996355158533*^9}, {3.762172136008264*^9, 3.762172171549264*^9}, {
   3.7621722759760637`*^9, 3.762172322963264*^9}, {3.7621723530712643`*^9, 
   3.762172374412064*^9}, {3.762172542117064*^9, 3.7621731137071123`*^9}, 
   3.76218544497956*^9, {3.7632797566142387`*^9, 3.763279757020537*^9}, {
   3.763280055283037*^9, 3.7632800554011793`*^9}, {3.766925322106447*^9, 
   3.766925322511407*^9}, {3.7669253947064247`*^9, 3.7669254259214697`*^9}, {
   3.7729466463893785`*^9, 3.7729466919217215`*^9}, {3.7729467291061373`*^9, 
   3.7729468268725653`*^9}, {3.7729489538413987`*^9, 3.772948978895934*^9}, {
   3.772949179347328*^9, 3.7729491990943565`*^9}, {3.772949234437462*^9, 
   3.772949250403804*^9}, {3.7729493007755866`*^9, 3.7729493959011416`*^9}, {
   3.772949437841954*^9, 3.7729494383122883`*^9}, {3.7729494956900263`*^9, 
   3.772949585626937*^9}, {3.772949647845134*^9, 3.77294969252087*^9}, {
   3.772953759308259*^9, 3.772953761004464*^9}, {3.772954200040321*^9, 
   3.7729542179980793`*^9}, {3.7729545381795444`*^9, 
   3.7729546177635665`*^9}, {3.7729546697224555`*^9, 3.772954711148904*^9}, {
   3.7729547489987726`*^9, 3.772954864649927*^9}, {3.7729549167919655`*^9, 
   3.772954927873433*^9}, {3.7729549741953173`*^9, 3.7729550237495403`*^9}, {
   3.772955058076904*^9, 3.7729550662617188`*^9}, {3.7729551188380675`*^9, 
   3.772955148294992*^9}, {3.7729588800790453`*^9, 3.7729588902873163`*^9}, {
   3.7737302557435217`*^9, 3.7737302563997726`*^9}, {3.7737302999522743`*^9, 
   3.773730400011524*^9}, {3.7737305586643724`*^9, 3.7737305588518696`*^9}, {
   3.7737310165290747`*^9, 3.7737310203574677`*^9}, {3.773731804830763*^9, 
   3.773731806908882*^9}, {3.773732764766808*^9, 3.773732816715843*^9}, {
   3.7740756290067196`*^9, 3.7740756291919546`*^9}, {3.7741626036936493`*^9, 
   3.77416261662247*^9}, {3.7741627685024967`*^9, 3.7741629187588263`*^9}, {
   3.774162949283251*^9, 3.774162952147439*^9}, 3.774167204047742*^9, {
   3.7741756964626117`*^9, 3.7741757854918404`*^9}, {3.7741758372935514`*^9, 
   3.774175991525239*^9}, {3.774196242892341*^9, 3.7741962845483065`*^9}, {
   3.7741964014998713`*^9, 3.7741964028180075`*^9}, {3.7741965711975274`*^9, 
   3.774196572532523*^9}, {3.774255859120303*^9, 3.7742558695476727`*^9}, {
   3.7742585857279654`*^9, 3.7742586067394547`*^9}, {3.7742599819896126`*^9, 
   3.7742599823093643`*^9}, {3.774261352318268*^9, 3.774261356613641*^9}, {
   3.7742654364882545`*^9, 3.7742654391543937`*^9}, {3.7742668542478905`*^9, 
   3.7742668560448575`*^9}, {3.7743337317405767`*^9, 3.774333732797306*^9}, {
   3.7743337723063726`*^9, 3.774333820762794*^9}, {3.7776365228175125`*^9, 
   3.7776365232588263`*^9}, {3.777636557095876*^9, 3.7776365919586897`*^9}, {
   3.777636623009755*^9, 3.777636682749245*^9}, {3.7776367253265305`*^9, 
   3.7776367452436953`*^9}, {3.777636785086054*^9, 3.7776368309566793`*^9}, {
   3.777637506410387*^9, 3.777637509488557*^9}, {3.7776376084449387`*^9, 
   3.7776376356422834`*^9}, {3.7776377441434774`*^9, 3.777637755026198*^9}, {
   3.7777048845479755`*^9, 3.777704890552248*^9}, {3.844949471077026*^9, 
   3.844949472971365*^9}, {3.844950117323367*^9, 3.844950174139578*^9}, {
   3.8449502172550907`*^9, 3.844950231218972*^9}, {3.844950768638299*^9, 
   3.844950804153434*^9}, {3.844950920384689*^9, 3.844950935415327*^9}, {
   3.8449510404296446`*^9, 3.8449510412982593`*^9}, {3.844951073886321*^9, 
   3.8449511167666864`*^9}, {3.8449512867869897`*^9, 3.84495133791117*^9}, {
   3.844951790786664*^9, 3.844951793684717*^9}, {3.844998230491818*^9, 
   3.8449982311402917`*^9}, 3.844998664293832*^9, {3.844998789552457*^9, 
   3.8449988459293747`*^9}, {3.844998891642705*^9, 3.844998932418561*^9}, {
   3.844999027646974*^9, 3.844999052927866*^9}, {3.8449993268226795`*^9, 
   3.8449993680869007`*^9}, {3.8449994895668707`*^9, 3.844999624838603*^9}, {
   3.8449998127796063`*^9, 3.8449998362812395`*^9}, {3.844999948713807*^9, 
   3.844999962175313*^9}, {3.84500002433132*^9, 3.845000073609194*^9}, {
   3.8450001716395693`*^9, 3.845000207619032*^9}, {3.845000241599079*^9, 
   3.845000260821682*^9}, {3.84500033849864*^9, 3.8450004057942576`*^9}, {
   3.845000575070073*^9, 3.845000660543563*^9}, {3.845001645028274*^9, 
   3.8450017043392487`*^9}, {3.8450019700262737`*^9, 
   3.8450020149120393`*^9}, {3.845002063929728*^9, 3.8450020832403955`*^9}, {
   3.845002820323002*^9, 3.8450028361752396`*^9}, {3.845003077424971*^9, 
   3.84500338374373*^9}, {3.845003591932068*^9, 3.8450036020502234`*^9}, {
   3.8450042282964635`*^9, 3.8450042371026955`*^9}, {3.8450043067550087`*^9, 
   3.8450044216563025`*^9}, {3.8450044602946672`*^9, 
   3.8450045970194263`*^9}, {3.8450046296224785`*^9, 
   3.8450049912658625`*^9}, {3.845005421716509*^9, 3.845005427536627*^9}, {
   3.8450056018259525`*^9, 3.8450057323289633`*^9}, {3.845005770041673*^9, 
   3.845005801196721*^9}, {3.845005832844118*^9, 3.8450058340849967`*^9}, {
   3.845005894452718*^9, 3.8450059306493344`*^9}, {3.845006106354679*^9, 
   3.8450061377719135`*^9}, {3.8450064567336397`*^9, 
   3.8450065651531425`*^9}, {3.845006596460297*^9, 3.845006621534247*^9}, {
   3.845008192185703*^9, 3.8450082087484245`*^9}, {3.8450082886409636`*^9, 
   3.845008290903545*^9}, {3.8450085726049223`*^9, 3.8450086170163527`*^9}, {
   3.845008667268915*^9, 3.8450086846792164`*^9}, {3.8450089403511534`*^9, 
   3.8450090876484003`*^9}, {3.845009118221051*^9, 3.845009551232462*^9}, {
   3.8450096897334785`*^9, 3.845009712350484*^9}, {3.8450097732275686`*^9, 
   3.845009938682517*^9}, {3.8450101535265603`*^9, 3.845010457876946*^9}, {
   3.845013520245615*^9, 3.8450135420930758`*^9}, {3.8450137714263525`*^9, 
   3.8450140070824413`*^9}, {3.845014066128234*^9, 3.845014066525496*^9}, {
   3.8450141329505033`*^9, 3.845014199170368*^9}, {3.8450142428332677`*^9, 
   3.8450142956686573`*^9}, 3.8450143758924313`*^9, {3.8450144497977533`*^9, 
   3.8450145204357233`*^9}, {3.84501460360058*^9, 3.845014605551961*^9}, {
   3.8450173492508984`*^9, 3.845017404473979*^9}, {3.8450175580206423`*^9, 
   3.845017584270199*^9}, {3.84501762325579*^9, 3.845017623969293*^9}, {
   3.8450176700579095`*^9, 3.8450176705962925`*^9}, {3.8450179699931927`*^9, 
   3.845017978004842*^9}, {3.845018023063731*^9, 3.8450180525726147`*^9}, {
   3.8450181819041424`*^9, 3.845018242404977*^9}, {3.8450183166024666`*^9, 
   3.845018326340356*^9}, {3.84501836027037*^9, 3.84501836049953*^9}, {
   3.8450183939121785`*^9, 3.8450184013034267`*^9}, {3.8450184495525727`*^9, 
   3.8450184885311575`*^9}, {3.845018645924523*^9, 3.845018647741809*^9}, {
   3.8450188527268972`*^9, 3.8450188797620287`*^9}, {3.845018923965293*^9, 
   3.845018959323313*^9}, {3.845019008786338*^9, 3.8450190222698603`*^9}, {
   3.845019230710372*^9, 3.8450192826551533`*^9}, {3.845019357928424*^9, 
   3.845019461657811*^9}, {3.8450198295201445`*^9, 3.8450202524674635`*^9}, {
   3.84502028492043*^9, 3.845020289916964*^9}, {3.8450203867284765`*^9, 
   3.8450203901088686`*^9}, {3.845020423451465*^9, 3.845020487193578*^9}, {
   3.845020884374359*^9, 3.8450209678664455`*^9}, {3.845021068244485*^9, 
   3.8450210847151375`*^9}, {3.845021346413342*^9, 3.8450213480054684`*^9}, {
   3.84502308442833*^9, 3.845023084498371*^9}, {3.845023126745267*^9, 
   3.8450231319379425`*^9}, {3.8450232307058396`*^9, 3.845023268073285*^9}, {
   3.8450233171300035`*^9, 3.845023324353112*^9}, {3.8450236891993318`*^9, 
   3.8450237328171797`*^9}, 3.845024125065773*^9, {3.8450243470898952`*^9, 
   3.8450244031195474`*^9}, {3.8450244816201015`*^9, 
   3.8450245558046026`*^9}, {3.845024600031921*^9, 3.845024699896594*^9}, {
   3.8450247633925123`*^9, 3.845024768534148*^9}, {3.8450250725623274`*^9, 
   3.8450252120119963`*^9}, {3.845025358826914*^9, 3.845025475264298*^9}, {
   3.845025511176731*^9, 3.845025626704489*^9}, {3.8450256703243384`*^9, 
   3.845025716754197*^9}, {3.845025834896806*^9, 3.845025846030687*^9}, {
   3.8450259752901626`*^9, 3.845026112972597*^9}, {3.8450263137276716`*^9, 
   3.845026469438867*^9}, {3.845026523865403*^9, 3.8450266226593003`*^9}, {
   3.8450266863343616`*^9, 3.8450266973761964`*^9}, {3.8450268106153135`*^9, 
   3.8450268447104425`*^9}, {3.845027249443869*^9, 3.8450272600493746`*^9}, {
   3.845027462132387*^9, 3.8450275804981537`*^9}, {3.84502762672689*^9, 
   3.8450276672105217`*^9}, {3.845027988128631*^9, 3.8450280903609805`*^9}, {
   3.8450281754972305`*^9, 3.8450281827683773`*^9}, {3.8450282559391575`*^9, 
   3.845028399702899*^9}, {3.845028547924794*^9, 3.845028575419252*^9}, {
   3.8450286580857544`*^9, 3.845028682110757*^9}, {3.8450290751969414`*^9, 
   3.8450291523925714`*^9}, {3.845029238394434*^9, 3.845029371852903*^9}, {
   3.8450294295167103`*^9, 3.8450296709845953`*^9}, {3.84502974731061*^9, 
   3.845029775228348*^9}, {3.845029889126952*^9, 3.8450299335954227`*^9}, {
   3.845030001051181*^9, 3.8450301621491885`*^9}, {3.8450302343943157`*^9, 
   3.845030249965336*^9}, {3.8450303648486166`*^9, 3.8450303717154765`*^9}, 
   3.845030420731167*^9, {3.8450305156353273`*^9, 3.8450305925607667`*^9}, {
   3.8450306522730355`*^9, 3.8450308118299627`*^9}, {3.845083846025426*^9, 
   3.8450838550598164`*^9}, {3.845084259714189*^9, 3.8450842879551735`*^9}, {
   3.8450853298605413`*^9, 3.845085335511521*^9}, 3.84508546114143*^9, {
   3.8450855146352854`*^9, 3.8450855379697986`*^9}, {3.8450856550246572`*^9, 
   3.845085716545368*^9}, {3.845085829347197*^9, 3.8450858521643453`*^9}, {
   3.8450860448857317`*^9, 3.845086075006049*^9}, 3.8450861921019163`*^9, {
   3.845086371522893*^9, 3.8450863774450817`*^9}, {3.8450864191335864`*^9, 
   3.845086641882222*^9}, {3.845086702001768*^9, 3.8450867687798085`*^9}, {
   3.8450868158090706`*^9, 3.845086855000806*^9}, {3.8450869271948967`*^9, 
   3.8450870024061275`*^9}, {3.8450871068570423`*^9, 
   3.8450871793043337`*^9}, {3.8450872270100737`*^9, 
   3.8450872767262573`*^9}, {3.8450873264034348`*^9, 
   3.8450874324684763`*^9}, {3.8450934176074915`*^9, 
   3.8450934259314027`*^9}, {3.8450940858243837`*^9, 3.845094133555162*^9}, 
   3.8450944076211166`*^9, {3.845094451025837*^9, 3.8450945492763643`*^9}, {
   3.8451103365535097`*^9, 3.845110463843583*^9}, {3.8451105207728815`*^9, 
   3.845110592068317*^9}, {3.845110728212665*^9, 3.8451107593096905`*^9}, {
   3.845110815940748*^9, 3.8451108552835913`*^9}, {3.845110943144769*^9, 
   3.845110962045147*^9}, {3.845110992554739*^9, 3.845111014850515*^9}, 
   3.8451110530275536`*^9, 3.8451110840104795`*^9, {3.8451112924650016`*^9, 
   3.8451113016044507`*^9}, {3.8451113450952272`*^9, 
   3.8451113610455356`*^9}, {3.8451114007155905`*^9, 3.845111496130114*^9}, {
   3.845111527335199*^9, 3.845111564900801*^9}, {3.8451116202469497`*^9, 
   3.8451116481637077`*^9}, {3.845115237362749*^9, 3.845115238818799*^9}, 
   3.8454400225628858`*^9, {3.8454400632626905`*^9, 3.845440076357958*^9}, {
   3.845440894974305*^9, 3.845440923872737*^9}, {3.8454409731576157`*^9, 
   3.8454410037042313`*^9}, {3.845441189589783*^9, 3.845441272195243*^9}, 
   3.8454522988870306`*^9, {3.8455192550304394`*^9, 3.845519260844542*^9}, 
   3.8456240443697605`*^9, {3.845624638493952*^9, 3.845624672702145*^9}, {
   3.845624928646161*^9, 3.845624999437229*^9}, {3.8456250676014175`*^9, 
   3.8456251174416866`*^9}, {3.8456253339077606`*^9, 
   3.8456254931446733`*^9}, {3.8456256010179477`*^9, 3.84562572701506*^9}, {
   3.8456263838766403`*^9, 3.8456263965645943`*^9}, {3.8456267344405565`*^9, 
   3.8456267416266575`*^9}, {3.845628276122352*^9, 3.845628281630247*^9}, {
   3.8456287125930257`*^9, 3.8456288160312004`*^9}, 3.8456289315188584`*^9, {
   3.845629382088524*^9, 3.8456293951017466`*^9}, {3.845629595842699*^9, 
   3.8456296086937885`*^9}, {3.8456296544141245`*^9, 
   3.8456296821677523`*^9}, {3.8456300752217584`*^9, 
   3.8456300792706223`*^9}, {3.84571297827993*^9, 3.845712981471187*^9}, {
   3.846215903826457*^9, 3.8462159094824543`*^9}, {3.8464338595213394`*^9, 
   3.846433875787915*^9}, {3.852279683254799*^9, 3.852279686043782*^9}, {
   3.8522797381708593`*^9, 3.852279788217457*^9}, {3.852279855349203*^9, 
   3.852280018145996*^9}, {3.852280085771094*^9, 3.852280125885624*^9}, {
   3.852280182846138*^9, 3.8522802122480526`*^9}, {3.8522802469077024`*^9, 
   3.8522802572650695`*^9}, {3.8522805840615067`*^9, 
   3.8522806265887575`*^9}, {3.852280695891048*^9, 3.852280949289278*^9}, {
   3.852280998261112*^9, 3.8522812930447807`*^9}, {3.8522813372111936`*^9, 
   3.8522813730877113`*^9}, {3.852281417707446*^9, 3.852281443761978*^9}, {
   3.8522815429795465`*^9, 3.852281626129688*^9}, {3.852281658696851*^9, 
   3.852281757560169*^9}, {3.8522826441544137`*^9, 3.852282646949404*^9}, {
   3.8522827421791363`*^9, 3.8522827456225853`*^9}, {3.8522828065279036`*^9, 
   3.852282822905552*^9}, {3.8522829573261614`*^9, 3.8522829590583935`*^9}, {
   3.852283377093726*^9, 3.852283378122458*^9}, {3.852283450880205*^9, 
   3.852283517384948*^9}, {3.8522857598319073`*^9, 3.852285760796593*^9}, {
   3.852286355288431*^9, 3.8522863629698954`*^9}, 3.852299117294397*^9, {
   3.8523002962499585`*^9, 3.8523002986846924`*^9}, 3.853810191151126*^9, {
   3.890713966816205*^9, 3.890713966982572*^9}, {3.8907140637932568`*^9, 
   3.8907140675201225`*^9}, {3.8907141426877823`*^9, 3.890714158467659*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"ca83755b-f55f-4017-827c-6439a4a15d75"],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", 
    RowBox[{"Helper", " ", "functions"}], "*)"}], "Subsubsection"], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "this", " ", "helper", " ", "function", " ", "will", " ", "analyse", " ", 
     "all", " ", "possible", " ", "connections", " ", "between", " ", "the", 
     " ", "endpoints", " ", "and", " ", "returns", " ", "pair", " ", "of", 
     " ", "points", " ", "with", " ", "short", " ", "connections"}], " ", "-",
     " ", 
    RowBox[{
    "these", " ", "gaps", " ", "are", " ", "likely", " ", "misdetections", 
     " ", "of", " ", "the", " ", "cell", " ", "boarder", " ", "and", " ", 
     "can", " ", "be", " ", "approximately", " ", "reconnected"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"branchRec", "[", 
     RowBox[{"pixel_", ",", "i_", ",", "j_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "branchRec1", ",", "branchRec2", ",", "branchRec3", ",", 
        "branchRec4"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "pick", " ", "all", " ", "endpoint", " ", "combinations", " ", "in", 
        " ", "the", " ", "range", " ", "set", " ", "by", " ", "i", " ", "and",
         " ", "j"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"branchRec1", "=", 
        RowBox[{"Subsets", "[", 
         RowBox[{"pixel", ",", 
          RowBox[{"{", "2", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], " ", ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "compute", " ", "the", " ", "distance", " ", "between", " ", "the", 
          " ", "pair", " ", "of", " ", "points", "\[IndentingNewLine]", 
          RowBox[{"https", ":"}]}], "//", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
             "questions"}], "/", "8272"}], "/", "calculating"}], "-", "the", 
          "-", "distance", "-", "between", "-", "the", "-", "coordinates", 
          "-", "in", "-", "a", "-", 
          RowBox[{"list", " ", 
           RowBox[{"(", 
            RowBox[{"website", " ", "last", " ", 
             RowBox[{"visited", ":", " ", 
              RowBox[{
               RowBox[{"11.", " ", "Nov", " ", "2021"}], " ", "-", " ", "3"}],
               ":", 
              RowBox[{"29", " ", 
               RowBox[{"p", ".", "m", "."}]}]}]}], ")"}]}]}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"branchRec2", "=", 
        RowBox[{"EuclideanDistance", "@@@", " ", "branchRec1"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "the", " ", "distance", " ", "is", " ", "added", " ", "to", " ", 
           "the", " ", "list", " ", "with", " ", "point"}], "-", 
          RowBox[{
          "combinations", " ", "and", " ", "grouped", " ", "to", " ", 
           "individual", " ", "sub"}], "-", "lists"}], ",", " ", 
         RowBox[{
         "containing", " ", "both", " ", "the", " ", "points", " ", "and", 
          " ", "the", " ", "distance"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"branchRec3", "=", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{"branchRec1", ",", "branchRec2"}], "]"}], ",", "1"}], 
           "]"}], ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"short", " ", "connections", " ", "are", " ", "selected"}], 
         ",", " ", 
         RowBox[{
         "the", " ", "threshold", " ", "is", " ", "set", " ", "to", " ", 
          "around", " ", "2", "\[Micro]m"}]}], "*)"}], "\[IndentingNewLine]", 
       
       RowBox[{"branchRec3", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"branchRec3", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "<", 
            RowBox[{"Round", "[", 
             RowBox[{"2", "/", "pixelSize"}], "]"}]}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "the", " ", "distance", " ", "is", " ", "deleted", " ", "from", " ", 
         "the", " ", "list"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"branchRec4", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", "3", "}"}]}], "]"}], "&"}], "/@", "branchRec3"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"return", " ", "the", " ", "endpoints"}], "*)"}], 
       "\[IndentingNewLine]", "branchRec4"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "helper", " ", "function", " ", "to", " ", "select", " ", "components", 
      " ", "in", " ", "an", " ", "image", " ", "based", " ", "on", " ", "an", 
      " ", "area"}], "-", 
     RowBox[{
      RowBox[{"threshold", ".", " ", "Instead"}], " ", "of", " ", "using", 
      " ", "the", " ", "build", " ", "in", " ", "function", " ", "in", " ", 
      "Mathematica", " ", "this", " ", "one", " ", "provides", " ", "a", " ", 
      "performance", " ", "benefit", " ", "on", " ", "large", " ", "images", 
      " ", "because", " ", "it", " ", "uses", " ", "a", " ", "matrix", " ", 
      "representation", " ", "of", " ", "the", " ", "image", " ", "which", 
      " ", "showed", " ", "better", " ", "performance", " ", "instead", " ", 
      "of", " ", "using", " ", "a", " ", "large", " ", "image", " ", 
      "object"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"selectComps", "[", 
     RowBox[{"image_", ",", "thres_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "compMeasure", ",", "compMeasure2", ",", "dispatchTable", ",", 
        "image2"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      
      RowBox[{"(*", 
       RowBox[{
       "gather", " ", "the", " ", "measurements", " ", "for", " ", "the", " ",
         "area", " ", "of", " ", "all", " ", "objects"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"compMeasure", "=", 
        RowBox[{"List", " ", "@@@", " ", 
         RowBox[{"ComponentMeasurements", "[", 
          RowBox[{"image", ",", "\"\<Area\>\""}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"return", " ", "the", " ", "image"}], ",", " ", 
         RowBox[{"if", " ", "the", " ", "image", " ", "is", " ", "empty"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "compMeasure", "]"}], "\[Equal]", "0"}], ",",
          "image", ",", 
         RowBox[{"(", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"select", " ", "list", " ", 
            RowBox[{"elements", "/", "objects"}], " ", "where", " ", "the", 
            " ", "area", " ", "is", " ", "larger", " ", "than", " ", "the", 
            " ", "defined", " ", 
            RowBox[{"threshold", ".", " ", "First"}], " ", "returns", " ", 
            "the", " ", "object", " ", "number"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"compMeasure2", "=", 
            RowBox[{"First", "/@", " ", 
             RowBox[{"Select", "[", 
              RowBox[{"compMeasure", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ">", "thres"}], "&"}]}], 
              "]"}]}]}], " ", ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"build", " ", "a", " ", "dispatch", " ", "table"}], ",", 
             " ", 
             RowBox[{
             "were", " ", "larger", " ", "objects", " ", "keep", " ", "their",
               " ", "number", " ", "and", " ", "smaller", " ", "ones", " ", 
              "get", " ", "the", " ", "label", " ", "\"\<0\>\""}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"dispatchTable", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"i", "\[Rule]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"compMeasure2", ",", "i"}], "]"}], ",", "i", ",", 
                  "0"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"First", "[", 
                 RowBox[{"Last", "[", "compMeasure", "]"}], "]"}]}], "}"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"dispatchTable", "=", 
            RowBox[{
             RowBox[{"Prepend", "[", 
              RowBox[{"dispatchTable", ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", "\[Rule]", "0"}], "}"}]}], "]"}], "//", 
             "Flatten"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "apply", " ", "the", " ", "dispatch", " ", "table", " ", "onto", 
             " ", "the", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"image2", "=", 
            RowBox[{"image", "/.", 
             RowBox[{"Dispatch", "[", "dispatchTable", "]"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"return", " ", "the", " ", "image", " ", "matrix"}], 
            "*)"}], "\[IndentingNewLine]", "image2"}], "\[IndentingNewLine]", 
          ")"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "helper", " ", "function", " ", "to", " ", "remove", " ", "objects", " ", 
     "in", " ", "the", " ", "image", " ", 
     RowBox[{"(", "map", ")"}], " ", "that", " ", "are", " ", "included", " ",
      "in", " ", "the", " ", 
     RowBox[{"mask", ".", " ", "By"}], " ", "the", " ", "given", " ", 
     "threshold", " ", "the", " ", "sensitivity", " ", "can", " ", "be", " ", 
     
     RowBox[{"adapted", ".", " ", "Instead"}], " ", "of", " ", "using", " ", 
     "the", " ", "build", " ", "in", " ", "function", " ", "in", " ", 
     "Mathematica", " ", "this", " ", "one", " ", "provides", " ", "a", " ", 
     "performance", " ", "benefit", " ", "on", " ", "large", " ", "images", 
     " ", "because", " ", "it", " ", "uses", " ", "a", " ", "matrix", " ", 
     "representation", " ", "of", " ", "the", " ", "image", " ", "which", " ",
      "showed", " ", "better", " ", "performance", " ", "instead", " ", "of", 
     " ", "using", " ", "a", " ", "large", " ", "image", " ", "object"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"computeComponentDiff", "[", 
     RowBox[{"map_", ",", "mask_", ",", "thres_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "mapMatrix", ",", "maskMatrix", ",", "max", ",", "countBefore", ",", 
        "countAfter", ",", "countMerged", ",", "dispatchTable", ",", "map2"}],
        "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Flatten", " ", "will", " ", "remove", " ", "the", " ", "matrix", " ",
          "structure"}], ";", " ", 
        RowBox[{
        "now", " ", "all", " ", "pixels", " ", "are", " ", "in", " ", "one", 
         " ", "large", " ", "list"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mapMatrix", "=", 
        RowBox[{"Flatten", "[", "map", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "convert", " ", "the", " ", "image", " ", "mask", " ", "into", " ", 
          "matrix", " ", "form"}], ",", " ", 
         RowBox[{
         "Flatten", " ", "will", " ", "convet", " ", "the", " ", "2", "D", 
          " ", "form", " ", "in", " ", "1", "D"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"maskMatrix", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ImageData", "[", "mask", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "get", " ", "the", " ", "highest", " ", "object", " ", "number"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"max", "=", 
        RowBox[{"Max", "[", "mapMatrix", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "BinCounts", " ", "returns", " ", "the", " ", "number", " ", "of", 
          " ", "pixels", " ", "for", " ", "each", " ", "object"}], ",", " ", 
         RowBox[{
         "since", " ", "every", " ", "object", " ", "has", " ", "its", " ", 
          "own", " ", 
          RowBox[{"label", "/", "value"}], " ", "in", " ", "the", " ", "list",
           " ", "of", " ", "pixel", " ", 
          RowBox[{"values", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"countBefore", "=", 
        RowBox[{"BinCounts", "[", 
         RowBox[{"mapMatrix", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"max", "+", "1"}], ",", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Pick", " ", "will", " ", "select", " ", "the", " ", "pixels", " ", 
          "in", " ", "the", " ", "image", " ", "that", " ", "have", " ", 
          "value", " ", "\"\<1\>\"", " ", "in", " ", "our", " ", "mask", " ", 
          "and", " ", "therefore", " ", "should", " ", "be", " ", 
          RowBox[{"removed", ".", " ", "Again"}]}], ",", " ", 
         RowBox[{
         "the", " ", "total", " ", "values", " ", "of", " ", "pixels", " ", 
          "are", " ", "counted"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"countAfter", "=", 
        RowBox[{"BinCounts", "[", 
         RowBox[{
          RowBox[{"Pick", "[", 
           RowBox[{"mapMatrix", ",", "maskMatrix", ",", "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"max", "+", "1"}], ",", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "zeros", " ", "are", " ", "replaced", " ", "by", " ", "\"\<1\>\"", 
         " ", "to", " ", "avoid", " ", "division", " ", "by", " ", "zero", 
         " ", "errors", " ", "in", " ", "the", " ", "next", " ", 
         RowBox[{"step", ".", " ", "This"}], " ", "does", " ", "not", " ", 
         "harm", " ", "the", " ", "results", " ", "since", " ", "the", " ", 
         "division", " ", "results", " ", "are", " ", "way", " ", "below", 
         " ", "the", " ", "threshold"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"countBefore", " ", "=", " ", 
        RowBox[{"countBefore", " ", "/.", 
         RowBox[{"{", 
          RowBox[{"0", "\[Rule]", "1"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"countAfter", " ", "=", " ", 
        RowBox[{"countAfter", " ", "/.", 
         RowBox[{"{", 
          RowBox[{"0", "\[Rule]", "1"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Calculate", " ", "the", " ", "quotient", " ", "of", " ", "all", " ", 
         "pixels", " ", "and", " ", "pixels", " ", "that", " ", "are", " ", 
         "also", " ", "included", " ", "in", " ", "the", " ", "map"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"countMerged", "=", 
        RowBox[{
         RowBox[{"countAfter", "/", "countBefore"}], "//", "N"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "create", " ", "a", " ", "dispatch", " ", "table", " ", "that", " ", 
         "will", " ", "remove", " ", "all", " ", "objects", " ", "that", " ", 
         "overlap", " ", "more", " ", "than", " ", "xx", "%", " ", 
         RowBox[{"(", 
          RowBox[{
          "defined", " ", "by", " ", "the", " ", "threshold", " ", 
           "variable"}], ")"}], " ", "with", " ", "the", " ", "mask"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"dispatchTable", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", "\[Rule]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"countMerged", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "<", "thres"}], ",", "i", ",",
               "0"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "max"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dispatchTable", "=", 
        RowBox[{
         RowBox[{"Prepend", "[", 
          RowBox[{"dispatchTable", ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", "\[Rule]", "0"}], "}"}]}], "]"}], "//", 
         "Flatten"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"apply", " ", "the", " ", "dispatch", " ", "table"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"map2", "=", 
        RowBox[{"map", "/.", 
         RowBox[{"Dispatch", "[", "dispatchTable", "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"return", " ", "new", " ", "image", " ", 
         RowBox[{"(", 
          RowBox[{"matrix", " ", "form"}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", "map2"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "this", " ", "helper", " ", "function", " ", "selects", " ", 
     "corresponding", " ", "components", " ", "in", " ", "two", " ", 
     "different", " ", "images", " ", "based", " ", "on", " ", "the", " ", 
     "Medoid", " ", 
     RowBox[{"values", ".", " ", "This"}], " ", "is", " ", "necessary", " ", 
     "because", " ", "the", " ", "automatic", " ", "numbering", " ", "for", 
     " ", "two", " ", "slightly", " ", "different", " ", "images", " ", 
     "doesn\.b4t", " ", "match", " ", "in", " ", "all", " ", 
     RowBox[{"cases", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"componentSorting", "[", 
     RowBox[{
     "data1_", ",", "data2_", ",", "col1_", ",", "col2_", ",", "thres_"}], 
     "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "centreCombinations", ",", "centreCombinations2", ",", 
        "distanceCentre", ",", "dataList", ",", "tab1", ",", "tab2", ",", " ",
         "list1", ",", "list2", ",", "finalCombination"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "gives", " ", "a", " ", "list", " ", "with", " ", "all", " ", 
         "possible", " ", "combinations", " ", "of", " ", "the", " ", 
         "medoid", " ", "values"}], ",", " ", 
        RowBox[{"the", " ", "centre", " ", "of", " ", "the", " ", 
         RowBox[{"objects", ".", " ", "col1"}], " ", "and", " ", "col2", " ", 
         "need", " ", "the", " ", "be", " ", "predefined"}], ",", " ", 
        RowBox[{
        "these", " ", "are", " ", "the", " ", "list", " ", "pointers", " ", 
         "for", " ", "the", " ", "Medoid", " ", "values", " ", "in", " ", 
         "the", " ", "data", " ", 
         RowBox[{"tables", ".", " ", "After"}], " ", "that", " ", "Flatten", 
         " ", "the", " ", "list"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"centreCombinations", "=", " ", 
        RowBox[{"Tuples", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"data1", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "col1"}], "]"}], "]"}], ",", 
           RowBox[{"data2", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "col2"}], "]"}], "]"}]}], "}"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"centreCombinations2", "=", " ", 
        RowBox[{"Flatten", " ", "[", 
         RowBox[{"centreCombinations", ",", "1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "compute", " ", "distance", " ", "between", " ", "the", " ", "two", 
          " ", "centre", " ", "points"}], ";", " ", 
         RowBox[{
          RowBox[{"similar", " ", "to", " ", "the", " ", "branchRec"}], "-", 
          "function"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"distanceCentre", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"EuclideanDistance", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"centreCombinations2", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"centreCombinations2", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", " ", "[", "centreCombinations2", "]"}], ",", 
            "2"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "distance", " ", "is", " ", "added", " ", "to", " ", 
          "the", " ", "list", " ", "of", " ", "medoid"}], "-", 
         "combinations"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"dataList", "=", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{"centreCombinations", ",", "distanceCentre"}], "]"}], 
            ",", "1"}], "]"}], ",", "3"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"select", " ", "the", " ", "short", " ", 
         RowBox[{"connections", ".", " ", "These"}], " ", "ones", " ", "are", 
         " ", "a", " ", "matching", " ", "component", " ", 
         RowBox[{"pair", ".", " ", "The"}], " ", "distance", " ", "is", " ", 
         "deleted", " ", "from", " ", "the", " ", "list"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"dataList", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"dataList", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "<", "thres"}], "&"}]}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"dataList", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{"#", ",", 
              RowBox[{"{", "3", "}"}]}], "]"}], "&"}], "/@", "dataList"}], 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"create", " ", "two", " ", "association", " ", 
         RowBox[{"lists", ":", " ", 
          RowBox[{
           RowBox[{"Medoid", " ", "--"}], ">", " ", 
           RowBox[{"number", " ", "component"}]}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"tab1", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"data1", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "col1"}], "]"}], "]"}], "\[Rule]", 
           RowBox[{"data1", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "data1", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tab2", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"data2", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "col2"}], "]"}], "]"}], "\[Rule]", 
           RowBox[{"data2", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "data2", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "replace", " ", "medoid", " ", "values", " ", "with", " ", "the", 
           " ", "component", " ", "numbers"}], ";", " ", 
          RowBox[{"every", " ", "1"}]}], ",", "3", ",", 
         RowBox[{
         "5", " ", "element", " ", "corresponds", " ", "to", " ", "the", " ", 
          "original", " ", "image", " ", "medoid"}], ",", " ", "2", ",", "4", 
         ",", 
         RowBox[{
          RowBox[{"6", "..."}], " ", "are", " ", "the", " ", "medoids", " ", 
          "in", " ", "the", " ", "smooth", " ", "image"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"list1", "=", 
        RowBox[{
         RowBox[{"dataList", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", 
            RowBox[{"-", "1"}], ";;", "2"}], "]"}], "]"}], " ", "/.", " ", 
         "tab1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"list2", "=", 
        RowBox[{
         RowBox[{"dataList", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "1"}], ";;", "2"}], "]"}], "]"}], " ", "/.", " ", 
         "tab2"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"create", " ", "final", " ", "pair"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"finalCombination", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Riffle", "[", 
           RowBox[{"list1", ",", "list2"}], "]"}], ",", "2"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"return", " ", "the", " ", "list", " ", "of", " ", "pair"}], 
        "*)"}], "\[IndentingNewLine]", "finalCombination"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "helper", " ", "function", " ", "that", " ", "is", " ", "used", " ", 
     "for", " ", "single", " ", "branch", " ", 
     RowBox[{"analysis", ".", " ", "For"}], " ", "a", " ", "given", " ", 
     "medoid", " ", 
     RowBox[{"(", 
      RowBox[{"from", " ", "a", " ", "cell", " ", "border", " ", "segment"}], 
      ")"}], " ", "it", " ", "searches", " ", "for", " ", "cell", " ", 
     "component", " ", "neighbour", " ", "and", " ", "returns", " ", "their", 
     " ", "numbers"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"neighbour", "[", 
     RowBox[{"medoid_", ",", "componentImage_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"kombi", ",", "neighbourPoints", ",", "neighbourCells"}], 
       "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "different", " ", "variations", " ", "of", " ", "positions", " ", 
        "around", " ", "the", " ", "medoid"}], "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{"kombi", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2"}], ",", 
            RowBox[{"-", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2"}], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2"}], ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", 
            RowBox[{"-", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "build", " ", "a", " ", "list", " ", "with", " ", "all", " ", 
          "surrounding", " ", "pixels", " ", "based", " ", "on", " ", "the", 
          " ", "given", " ", 
          RowBox[{"medoid", ".", " ", "Round"}], " ", "is", " ", 
          "important"}], ",", " ", 
         RowBox[{
         "otherwise", " ", "it", " ", "gives", " ", "scrambled", " ", 
          "results"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"neighbourPoints", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Round", "[", "medoid", "]"}], "+", 
           RowBox[{"kombi", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "kombi", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Get", " ", "the", " ", "number", " ", "of", " ", "each", " ", 
          "component", " ", "surrounding", "\[IndentingNewLine]", 
          RowBox[{"https", ":"}]}], "//", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
             "questions"}], "/", "100513"}], "/", "finding"}], "-", "pixel", 
          "-", "coordinates", "-", "from", "-", "morphological", "-", 
          RowBox[{"components", " ", 
           RowBox[{"(", 
            RowBox[{"website", " ", "last", " ", 
             RowBox[{"visited", ":", " ", 
              RowBox[{
               RowBox[{"11.", " ", "Nov", " ", "2021"}], " ", "-", " ", "3"}],
               ":", 
              RowBox[{"30", " ", 
               RowBox[{"p", ".", "m", "."}]}]}]}], ")"}]}]}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"neighbourCells", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"PixelValue", "[", 
           RowBox[{"componentImage", ",", " ", 
            RowBox[{"neighbourPoints", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", " ", "[", "neighbourPoints", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Delete", " ", "zeros", " ", "and", " ", "duplicates"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"neighbourCells", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Round", "[", "neighbourCells", "]"}], ",", "0"}], "]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "return", " ", "the", " ", "list", " ", "with", " ", "neighbour", " ",
          "cell", " ", "numbers"}], "*)"}], "\[IndentingNewLine]", 
       "neighbourCells"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "this", " ", "helper", " ", "function", " ", "provides", " ", "modelling",
      " ", "algorithms", " ", "to", " ", "determine", " ", "if", " ", "a", 
     " ", "segment", " ", "is", " ", "pulled", " ", "by", " ", "one", " ", 
     "specific", " ", "neighbour", " ", 
     RowBox[{"cell", "/", "genotype"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"branchAnalysisGFP", "[", 
     RowBox[{
     "i_", ",", "dataNormal_", ",", "dataBranches_", ",", "branchesRiffled_", 
      ",", "imageAllcells_", ",", "imageGFPcells_", ",", 
      "imageNonGFPcells_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "branch", ",", "centroidPos", ",", "centroidCell", ",", 
        "expansionDirection", ",", "branchEnds", ",", "branchConnected", ",", 
        "totalArea", ",", "areaOverlappedGFP", ",", "areaOverlappedNon", ",", 
        "areaOverlappedDiff", ",", "listElement"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "this", " ", "analysis", " ", "only", " ", "works", " ", "on", " ", 
        "branches", " ", "that", " ", "have", " ", "two", " ", "different", 
        " ", "cell", " ", 
        RowBox[{"neighbours", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"dataBranches", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "7"}], "]"}], "]"}], " ", "\[Equal]", " ", 
          RowBox[{"{", 
           RowBox[{"False", ",", "True"}], "}"}]}], "||", " ", 
         RowBox[{
          RowBox[{"dataBranches", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "7"}], "]"}], "]"}], " ", "\[Equal]", " ", 
          RowBox[{"{", 
           RowBox[{"True", ",", "False"}], "}"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"select", " ", "the", " ", "specific", " ", "branch"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"branch", "=", 
            RowBox[{"SelectComponents", "[", 
             RowBox[{"branchesRiffled", ",", 
              RowBox[{
               RowBox[{"#Label", "\[Equal]", 
                RowBox[{"dataBranches", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}]}], " ", "&"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "measure", " ", "the", " ", "centroid", " ", "value", " ", "of", 
             " ", "the", " ", "branch", " ", 
             RowBox[{"object", ".", " ", "Depending"}], " ", "on", " ", "the",
              " ", "position", " ", "of", " ", "the", " ", "centroid", " ", 
             "it", " ", "can", " ", "be", " ", "determined", " ", "in", " ", 
             "which", " ", "direction", " ", "the", " ", "segment", " ", 
             "bulges"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"centroidPos", "=", 
            RowBox[{"List", "@@@", 
             RowBox[{"ComponentMeasurements", "[", 
              RowBox[{"branch", ",", "\"\<Centroid\>\""}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"get", " ", "the", " ", "pixel", " ", 
             RowBox[{"value", "/", "cell"}], " ", "number", " ", "of", " ", 
             "the", " ", "cell", " ", "where", " ", "the", " ", "centroid", 
             " ", "is", " ", "located"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"centroidCell", "=", 
            RowBox[{"Round", "[", 
             RowBox[{"PixelValue", "[", 
              RowBox[{"imageAllcells", ",", 
               RowBox[{"centroidPos", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}], "]"}]}], ";",
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "when", " ", "no", " ", "cell", " ", "number", " ", "is", " ", 
              "found", " ", 
              RowBox[{"(", 
               RowBox[{
               "in", " ", "case", " ", "the", " ", "centroid", " ", "is", " ",
                 "between", " ", "two", " ", "cell", " ", "objects"}], ")"}], 
              " ", "the", " ", "centroidCell", " ", "value", " ", "is", " ", 
              RowBox[{"\"\<0\>\"", ".", " ", "An"}], " ", "error", " ", 
              "message", " ", "is", " ", "deactivated", " ", "because", " ", 
              "in", " ", "the", " ", "further", " ", "steps", " ", "no", " ", 
              "list", " ", "element", " ", "with", " ", "pointer", " ", 
              "\"\<0\>\"", " ", "is", " ", "found", " ", "and", " ", 
              "otherwise", " ", "the", " ", "error", " ", "is", " ", 
              RowBox[{"displayed", ".", " ", "The"}], " ", "switch", " ", 
              "statement", " ", "later", " ", "will", " ", "then", " ", 
              "correctly", " ", "return", " ", 
              "\"\<non distinguishable\>\""}], ",", " ", 
             RowBox[{
             "so", " ", "the", " ", "error", " ", "can", " ", "be", " ", 
              "ignored"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Off", "[", 
            RowBox[{"Part", "::", "partw"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Off", "[", 
            RowBox[{"Part", "::", "partd"}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "decide", " ", "which", " ", "GFP", " ", "value", " ", "this", 
              " ", "cell", " ", "has"}], " ", "-", " ", 
             RowBox[{
             "know", " ", "we", " ", "can", " ", "make", " ", "a", " ", 
              "statement", " ", "which", " ", "genotype", " ", "might", " ", 
              "pull", " ", "on", " ", "the", " ", "segment"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"listElement", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Select", "[", 
               RowBox[{"dataNormal", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
                  "centroidCell"}], "&"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"expansionDirection", "=", 
            RowBox[{"Switch", "[", 
             RowBox[{
              RowBox[{"listElement", "[", 
               RowBox[{"[", "15", "]"}], "]"}], ",", "True", ",", 
              "\"\<non GFP cell pulls\>\"", ",", "False", ",", 
              "\"\<GFP cell pulls\>\"", ",", "_", ",", 
              "\"\<non distinguishable\>\""}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "in", " ", "a", " ", "second", " ", "part", " ", "of", " ", 
              "the", " ", "modelling", " ", "the", " ", "enclosed", " ", 
              "area", " ", "is", " ", "computed", " ", "and", " ", 
              "overlapped", " ", "with", " ", "the", " ", 
              RowBox[{"cells", ".", " ", "Depending"}], " ", "which", " ", 
              RowBox[{"GFP", "/", "genotype"}], " ", "has", " ", "more", " ", 
              "overlapping", " ", "area"}], ",", " ", "again", ",", " ", 
             RowBox[{
             "we", " ", "can", " ", "decide", " ", "which", " ", "genotypes", 
              " ", "might", " ", "pull", " ", "on", " ", "the", " ", 
              "segment"}]}], "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "first", " ", "the", " ", "endpoints", " ", "of", " ", "the", " ",
              "branch", " ", "are", " ", "picked"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"branchEnds", "=", 
            RowBox[{"PixelValuePositions", "[", 
             RowBox[{
              RowBox[{"MorphologicalTransform", "[", 
               RowBox[{
                RowBox[{"Binarize", "[", "branch", "]"}], ",", " ", 
                "\"\<EndPoints\>\""}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "the", " ", "endpoints", " ", "are", " ", "connected", " ", 
             "with", " ", "a", " ", "thin", " ", "line", " ", "and", " ", 
             "converted", " ", "in", " ", "an", " ", "object", " ", "by", " ",
              "using", " ", "the", " ", "watershed", " ", 
             RowBox[{"function", ".", " ", "The"}], " ", "other", " ", 
             "detected", " ", "objects", " ", "are", " ", "removed"}], "*)"}],
            "\[IndentingNewLine]", 
           RowBox[{"branchConnected", "=", 
            RowBox[{"Show", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"branch", ",", 
                RowBox[{"Graphics", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Thickness", "[", "0.001", "]"}], ",", "White", 
                   ",", 
                   RowBox[{"Line", "@", "branchEnds"}]}], "}"}], "]"}]}], 
               "}"}], ",", 
              RowBox[{"ImageSize", "\[Rule]", " ", 
               RowBox[{"ImageDimensions", "[", "branch", "]"}]}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"branchConnected", "=", 
            RowBox[{"WatershedComponents", "[", 
             RowBox[{"branchConnected", ",", 
              RowBox[{"Method", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<MinimumSaliency\>\"", ",", "0"}], "}"}]}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"branchConnected", "=", 
            RowBox[{"Binarize", "[", 
             RowBox[{
              RowBox[{"SelectComponents", "[", 
               RowBox[{"branchConnected", ",", 
                RowBox[{
                 RowBox[{"#AdjacentBorderCount", "==", "0"}], "&"}]}], "]"}], 
              "//", "Colorize"}], "]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "measure", " ", "the", " ", "total", " ", "number", " ", "of", 
              " ", "pixels", " ", "of", " ", "this", " ", "new", " ", 
              "object"}], " ", "-", " ", 
             RowBox[{
             "the", " ", "branch", " ", "with", " ", "enclosed", " ", 
              RowBox[{"area", ".", " ", "Convert"}], " ", "the", " ", "pixel",
               " ", "value", " ", "into", " ", "\[Micro]m"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"totalArea", "=", 
            RowBox[{"Total", "[", 
             RowBox[{"List", " ", "@@@", 
              RowBox[{"ComponentMeasurements", "[", 
               RowBox[{"branchConnected", ",", "\"\<Count\>\""}], "]"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"totalArea", "=", 
            RowBox[{
             RowBox[{"totalArea", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", 
              RowBox[{"pixelSize", "^", "2"}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "look", " ", "up", " ", "how", " ", "much", " ", "area", " ", 
             "is", " ", "overlapped", " ", "with", " ", "each", " ", "GFP", 
             " ", "and", " ", "non", " ", "GFP", " ", "cell"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"areaOverlappedGFP", "=", 
            RowBox[{
             RowBox[{"Length", "@", 
              RowBox[{"ImageValuePositions", "[", 
               RowBox[{
                RowBox[{"imageGFPcells", "+", "branchConnected"}], ",", "2"}],
                "]"}]}], "*", 
             RowBox[{"(", 
              RowBox[{"pixelSize", "^", "2"}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"areaOverlappedNon", "=", 
            RowBox[{
             RowBox[{"Length", "@", 
              RowBox[{"ImageValuePositions", "[", 
               RowBox[{
                RowBox[{"imageNonGFPcells", "+", "branchConnected"}], ",", 
                "2"}], "]"}]}], "*", 
             RowBox[{"(", 
              RowBox[{"pixelSize", "^", "2"}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "the", " ", "difference", " ", "from", " ", "the", " ", 
                "enclosed", " ", "areas", " ", "is", " ", 
                RowBox[{"calculated", ".", " ", "When"}], " ", "the", " ", 
                "area", " ", "is", " ", "positive", " ", "this", " ", "means",
                 " ", "most", " ", "of", " ", "the", " ", "enclosed", " ", 
                "area", " ", "is", " ", "overlapped", " ", "with", " ", "the",
                 " ", "non"}], "-", 
               RowBox[{"GFP", " ", 
                RowBox[{"cell", " ", "--"}]}]}], ">", " ", 
              RowBox[{
               RowBox[{"the", " ", "border"}], "-", 
               RowBox[{
               "segment", " ", "is", " ", "pulled", " ", "by", " ", "the", 
                " ", "GFP", " ", "cell"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
              "when", " ", "the", " ", "area", " ", "is", " ", "negative", 
               " ", "this", " ", "means", " ", "most", " ", "of", " ", "the", 
               " ", "enclosed", " ", "area", " ", "is", " ", "overlapped", 
               " ", "with", " ", "the", " ", "GFP", " ", 
               RowBox[{"cell", " ", "--"}]}], ">", " ", 
              RowBox[{
               RowBox[{"the", " ", "border"}], "-", 
               RowBox[{
               "segment", " ", "is", " ", "pulled", " ", "by", " ", "the", 
                " ", "non"}], "-", 
               RowBox[{"GPF", " ", "cell"}]}]}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"areaOverlappedDiff", "=", 
            RowBox[{"areaOverlappedNon", "-", "areaOverlappedGFP"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"return", " ", "the", " ", "results"}], "*)"}], 
           "\[IndentingNewLine]", "expansionDirection"}], ",", "totalArea", 
          ",", "areaOverlappedDiff"}], "\[IndentingNewLine]", "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "return", " ", "placeholder", " ", "results", " ", "if", " ", 
           "branch", " ", "has", " ", "only", " ", "1", " ", "detected", " ", 
           "neighbour", " ", "or", " ", "both", " ", "have", " ", "the", " ", 
           "same", " ", "genotype"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"\"\<Null\>\"", ",", "0", ",", "0"}], "\[IndentingNewLine]", 
         "}"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "helper", " ", "function", " ", "that", " ", "is", " ", "used", " ", 
      "for", " ", "single", " ", "branch", " ", 
      RowBox[{"analysis", ".", " ", "So"}], " ", "far", " ", "the", " ", 
      "data", " ", "table", " ", "only", " ", "shows", " ", "which", " ", 
      "neighbour", " ", "cells", " ", "belong", " ", "to", " ", "a", " ", 
      RowBox[{"segment", ".", " ", "With"}], " ", "this", " ", "function", 
      " ", "the", " ", "information", " ", "is", " ", "\"\<swapped\>\""}], 
     " ", "-", " ", 
     RowBox[{
     "it", " ", "identifies", " ", "all", " ", "branches", " ", "that", " ", 
      "belong", " ", "to", " ", "one", " ", "cell"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"backSorting", "[", 
     RowBox[{"cellCompNumber_", ",", "dataBranches_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "branches", "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "select", " ", "all", " ", "branches", " ", "that", " ", "are", " ", 
        "part", " ", "of", " ", "the", " ", "cell", " ", "component"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"branches", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"dataBranches", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "6", "]"}], "]"}], ",", "cellCompNumber"}], "]"}],
             "\[Equal]", "True"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"return", " ", "all", " ", "R"}], "-", 
         RowBox[{"indices", " ", "of", " ", "these", " ", "branches"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"branches", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "helper", " ", "function", " ", "that", " ", "is", " ", "used", " ", 
     "for", " ", "form", " ", 
     RowBox[{"analysis", ":", " ", 
      RowBox[{
      "rotates", " ", "each", " ", "cell", " ", "object", " ", "by", " ", 
       "the", " ", "given", " ", "angle", " ", "value", "\[IndentingNewLine]",
        "Cave"}], ":", " ", 
      RowBox[{
       RowBox[{"values", " ", "are", " ", "hardcoded"}], " ", "-", " ", 
       RowBox[{
       "when", " ", "changing", " ", "the", " ", "ComponentMeasurements"}], 
       "-", 
       RowBox[{
       "function", " ", "in", " ", "the", " ", "main", " ", "part", " ", "it",
         " ", "might", " ", "need", " ", "adjustments", " ", "to", " ", "the",
         " ", "list", " ", "positions"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rotateCrop", "[", 
     RowBox[{"x_", ",", "map_", ",", "measure_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "rot1", ",", "rot2", ",", "rot3", ",", "max2", ",", "rotMeasure"}], 
       "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"select", " ", "cell"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rot1", "=", 
        RowBox[{"SelectComponents", "[", 
         RowBox[{"map", ",", 
          RowBox[{
           RowBox[{"#Label", " ", "\[Equal]", 
            RowBox[{"measure", "[", 
             RowBox[{"[", 
              RowBox[{"x", ",", "1"}], "]"}], "]"}]}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"create", " ", "binarized", " ", "image"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"rot1", "=", 
        RowBox[{"Binarize", "[", 
         RowBox[{"Image", "[", 
          RowBox[{"rot1", ",", 
           RowBox[{"ColorSpace", "\[Rule]", "\"\<Grayscale\>\""}]}], "]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"compute", " ", "rough", " ", "max", " ", 
          RowBox[{"elongation", " ", "--"}]}], ">", " ", 
         RowBox[{"speeds", " ", "up", " ", "next", " ", "step"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"max2", "=", 
        RowBox[{
         RowBox[{"measure", "[", 
          RowBox[{"[", 
           RowBox[{"x", ",", "4"}], "]"}], "]"}], "*", 
         RowBox[{"2", "/", "3"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "trim", " ", "image", " ", "to", " ", "smaller", " ", "size"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"rot2", "=", " ", 
        RowBox[{"ImageTrim", "[", 
         RowBox[{"rot1", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"measure", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "5"}], "]"}], "]"}], "-", "max2"}], ",", 
            RowBox[{
             RowBox[{"measure", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "5"}], "]"}], "]"}], "+", "max2"}]}], "}"}], 
          ",", " ", 
          RowBox[{"Padding", "\[Rule]", "Black"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"rotate", " ", 
         RowBox[{"image", "/", "component"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"rot2", "=", " ", 
        RowBox[{"ImageRotate", "[", 
         RowBox[{"rot2", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"180", "-", 
             RowBox[{"measure", "[", 
              RowBox[{"[", 
               RowBox[{"x", ",", "3"}], "]"}], "]"}]}], ")"}], " ", 
           "Degree"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"compute", " ", "new", " ", "centroid", " ", "value"}], ",", 
         " ", 
         RowBox[{"delete", " ", "list", " ", "association"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"rotMeasure", "=", 
        RowBox[{"ComponentMeasurements", "[", 
         RowBox[{"rot2", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<Centroid\>\"", ",", "\"\<Length\>\""}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rotMeasure", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
         "rotMeasure"}]}], " ", ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"crop", " ", "image", " ", "to", " ", "500", "x500", " ", 
         RowBox[{"pixel", ".", " ", "The"}], " ", "centroid", " ", "of", " ", 
         "the", " ", "cell", " ", "is", " ", "aligned", " ", "in", " ", "the",
          " ", "image", " ", 
         RowBox[{"centre", ".", " ", "Image"}], " ", "is", " ", "transformed",
          " ", "into", " ", "a", " ", "matrix"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"rot3", "=", " ", 
        RowBox[{"ImageData", "[", 
         RowBox[{"ImageCrop", "[", 
          RowBox[{
           RowBox[{"ImageTrim", "[", 
            RowBox[{"rot2", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"rotMeasure", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", "249.5"}], ",", 
               
               RowBox[{
                RowBox[{"rotMeasure", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2"}], "]"}], "]"}], "+", "249.5"}]}], 
              "}"}], ",", " ", 
             RowBox[{"Padding", "\[Rule]", "Black"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"500", ",", "500"}], "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"return", " ", "the", " ", "image", " ", "matrix"}], "*)"}], 
       "\[IndentingNewLine]", "rot3"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "helper", " ", "function", " ", "that", " ", "is", " ", "used", " ", 
      "for", " ", "form", " ", 
      RowBox[{"analysis", ":", " ", 
       RowBox[{
       "Creates", " ", "a", " ", "heatmap", " ", "coloured", " ", "image", 
        " ", "with", " ", "all", " ", "cells", " ", "overlapped"}]}]}], ";", 
     " ", 
     RowBox[{
     "pixels", " ", "that", " ", "are", " ", "shared", " ", "by", " ", "more",
       " ", "cells", " ", "get", " ", "a", " ", "stronger", " ", "colour", 
      " ", 
      RowBox[{"(", "red", ")"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"changeColour", "[", "matrix_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"colour", ",", "table1", ",", "table2", ",", "output"}], "}"}],
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"define", " ", "colour", " ", "function"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"colour", "=", 
        RowBox[{"ColorData", "[", "\"\<Rainbow\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"lockup", " ", "the", " ", "RGB"}], "-", 
          RowBox[{
          "colour", " ", "for", " ", "each", " ", "label", " ", "in", " ", 
           "the", " ", "image"}]}], ",", 
         RowBox[{
         "the", " ", "highest", " ", "label", " ", "is", " ", "in", " ", 
          "the", " ", "centre", " ", "where", " ", "all", " ", "cells", " ", 
          "are", " ", "overlapped"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"table1", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"colour", "[", 
           RowBox[{"i", "/", 
            RowBox[{"Max", "[", "matrix", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Max", "[", "matrix", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"build", " ", "association", " ", "table"}], ";", " ", 
          RowBox[{
           RowBox[{"#label", " ", "--"}], ">", " ", 
           RowBox[{"new", " ", "colour"}]}]}], ",", " ", 
         RowBox[{
         "RGB", " ", "colour", " ", "codes", " ", "have", " ", "3", " ", 
          "values"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"table2", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"table1", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"table1", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"table1", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "3"}], "]"}], "]"}]}], "}"}]}], "}"}], ",", 
          
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "table1", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "black", " ", "parts", " ", "should", " ", "stay", " ", "black"}], 
         ",", " ", 
         RowBox[{"but", " ", "also", " ", "RGB", " ", "coded"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"table2", "=", 
        RowBox[{
         RowBox[{"Prepend", "[", 
          RowBox[{"table2", ",", 
           RowBox[{"{", 
            RowBox[{"0", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}]}], "]"}], "//",
          "Flatten"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "replace", " ", "each", " ", "label", " ", "number", " ", "with", 
          " ", "the", " ", "corresponding", " ", "new", " ", "colour"}], ";", 
         " ", 
         RowBox[{
         "the", " ", "new", " ", "matrix", " ", "has", " ", "RGB", " ", 
          "coded", " ", "pixels", " ", "and", " ", "can", " ", "be", " ", 
          "converted", " ", "back", " ", "into", " ", "an", " ", 
          RowBox[{"image", ".", " ", "Normal"}], " ", "is", " ", "needed", 
          " ", "to", " ", "make", " ", "it", " ", "work", " ", "on", " ", 
          "the", " ", "inputted", " ", "SparseArrey"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"Image", "[", 
         RowBox[{
          RowBox[{"Normal", "[", "matrix", "]"}], "/.", 
          RowBox[{"Dispatch", "[", "table2", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"return", " ", "image"}], "*)"}], "\[IndentingNewLine]", 
       "output"}]}], "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782774295518*^9}, {3.7403908710152287`*^9, 
   3.740390904306226*^9}, 3.740391508989131*^9, 3.74039154850494*^9, {
   3.743432314264383*^9, 3.74343234587469*^9}, {3.7437487525435*^9, 
   3.743748780185173*^9}, {3.7437488225563507`*^9, 3.7437489572381835`*^9}, {
   3.7437515811383505`*^9, 3.7437517047623353`*^9}, {3.7437538598746605`*^9, 
   3.7437538850105295`*^9}, {3.74495773545614*^9, 3.744957761353165*^9}, {
   3.74495787718661*^9, 3.744957888705905*^9}, {3.745224764657011*^9, 
   3.745224814226226*^9}, 3.745224904207001*^9, {3.745225006816019*^9, 
   3.7452250313041306`*^9}, {3.745225095000407*^9, 3.74522513789783*^9}, {
   3.7452293149515743`*^9, 3.7452293174362354`*^9}, 3.7613144633519855`*^9, {
   3.7613145111380787`*^9, 3.7613145113580422`*^9}, {3.7613146448581104`*^9, 
   3.7613146742781296`*^9}, {3.761314704438197*^9, 3.761314734458376*^9}, {
   3.7613147718883686`*^9, 3.761314840438471*^9}, {3.7613161196123266`*^9, 
   3.7613161294731083`*^9}, {3.761316744744779*^9, 3.761316752371785*^9}, {
   3.7613171703726344`*^9, 3.761317188395846*^9}, {3.7613175042850943`*^9, 
   3.761317506452593*^9}, {3.7613858146167*^9, 3.7613859523958845`*^9}, {
   3.7613955938867865`*^9, 3.761395603240579*^9}, {3.7617510945982056`*^9, 
   3.76175148235588*^9}, {3.761751520197472*^9, 3.761751532683305*^9}, {
   3.7617517246662273`*^9, 3.76175172514545*^9}, {3.761751888298921*^9, 
   3.7617519124491277`*^9}, {3.7617519446385975`*^9, 3.761751962952301*^9}, {
   3.7617523170163736`*^9, 3.7617524152599597`*^9}, 3.7617525540594535`*^9, {
   3.7617526860752983`*^9, 3.7617526897392435`*^9}, {3.761763205785245*^9, 
   3.7617632173637114`*^9}, {3.761990630304537*^9, 3.761990694826851*^9}, {
   3.7619907258239098`*^9, 3.7619907308033113`*^9}, {3.761996317507848*^9, 
   3.761996355158533*^9}, {3.762172136008264*^9, 3.762172213139264*^9}, {
   3.763280020561277*^9, 3.7632800206356845`*^9}, {3.7741626204683547`*^9, 
   3.774162757683381*^9}, {3.774166991844348*^9, 3.7741670123485527`*^9}, {
   3.774167115009127*^9, 3.774167130885092*^9}, 3.774167196435305*^9, {
   3.7741962983513613`*^9, 3.7741963010617228`*^9}, {3.7741965984173307`*^9, 
   3.7741966005261793`*^9}, {3.7742565633362284`*^9, 3.774256568057304*^9}, {
   3.7742585664891443`*^9, 3.7742585670851955`*^9}, {3.7742757976602783`*^9, 
   3.774275799135812*^9}, {3.777636572451816*^9, 3.77763657302022*^9}, {
   3.777637555573354*^9, 3.7776375838854775`*^9}, {3.8449502483951254`*^9, 
   3.84495025574633*^9}, {3.844950286474074*^9, 3.8449503797901154`*^9}, 
   3.845002768659439*^9, {3.8450075725572586`*^9, 3.845007599156082*^9}, 
   3.8450083834260426`*^9, {3.845010834433413*^9, 3.845010860525881*^9}, 
   3.8450134271467295`*^9, 3.8450215270421696`*^9, {3.845023048185671*^9, 
   3.845023058681099*^9}, 3.845023648370418*^9, {3.845027130389615*^9, 
   3.84502713217488*^9}, {3.8450284428824563`*^9, 3.845028445284156*^9}, {
   3.845029964063016*^9, 3.8450299808488655`*^9}, {3.845031006884983*^9, 
   3.8450310075374637`*^9}, {3.8450877765429745`*^9, 
   3.8450877805207896`*^9}, {3.845094316546684*^9, 3.8450943649669333`*^9}, {
   3.8451116932015996`*^9, 3.8451117511396017`*^9}, {3.8451117891565065`*^9, 
   3.8451118859109783`*^9}, {3.845111985442395*^9, 3.845112029121315*^9}, {
   3.845112141975174*^9, 3.8451121920626397`*^9}, {3.845112224307459*^9, 
   3.845112231448513*^9}, {3.845113695934681*^9, 3.845113697685902*^9}, {
   3.8451152265621185`*^9, 3.8451152273486805`*^9}, {3.8454394649942985`*^9, 
   3.8454394743679333`*^9}, {3.845606092179652*^9, 3.8456060941170216`*^9}, {
   3.845629742914716*^9, 3.8456297493842916`*^9}, {3.8456297927849865`*^9, 
   3.8456297987331944`*^9}, {3.845648747281872*^9, 3.84564879642665*^9}, 
   3.8456489726155815`*^9, {3.845696254804489*^9, 3.845696255009653*^9}, {
   3.846208030715333*^9, 3.8462081136855545`*^9}, {3.846943986070299*^9, 
   3.8469439893496284`*^9}, {3.8522722411241074`*^9, 3.852272245325098*^9}, {
   3.852272475601882*^9, 3.852272490183253*^9}, {3.852273652051645*^9, 
   3.8522736583791437`*^9}, {3.8522818135299807`*^9, 3.852281854132859*^9}, 
   3.8648885127550154`*^9, {3.890714175955818*^9, 3.8907141875531607`*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"16bc000c-e236-4abb-9b42-ff78f872cab5"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Run", "Chapter"]], "Chapter",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
  3.73978269312477*^9, 3.739782701661848*^9}, {3.7397827877180996`*^9, 
  3.739782797415943*^9}, {3.7398567048804107`*^9, 
  3.739856709407942*^9}},ExpressionUUID->"be09d115-7c4d-4ac8-a107-\
98431ab6605e"],

Cell["1. Quit all Mathematica kernels", "Subtitle",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782701661848*^9}, {3.7397827877180996`*^9, 
   3.739782797415943*^9}, {3.7398567048804107`*^9, 3.7398568049955177`*^9}, {
   3.772955180414822*^9, 3.7729551939644566`*^9}, {3.7729597528123713`*^9, 
   3.772959763168728*^9}, 
   3.8449493144331684`*^9},ExpressionUUID->"8cddcda2-3502-460b-8a40-\
ed065cf3a86e"],

Cell[BoxData[
 RowBox[{"Quit", "[", "]"}]], "Input",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782701661848*^9}, {3.7397827877180996`*^9, 
   3.7397828102040386`*^9}, {3.743432180434987*^9, 3.7434321827319355`*^9}, {
   3.761385986219534*^9, 3.7613859956121025`*^9}, {3.7613953886103444`*^9, 
   3.761395389616133*^9}, {3.7617516668769855`*^9, 3.761751673125464*^9}, {
   3.761753247270627*^9, 3.7617532475126104`*^9}, {3.762173260646184*^9, 
   3.7621732629861994`*^9}, {3.762185393375825*^9, 3.762185393882185*^9}, {
   3.762189189855327*^9, 3.762189190894086*^9}, {3.7623436944424505`*^9, 
   3.76234369495643*^9}, {3.762343882786497*^9, 3.7623439506344748`*^9}, {
   3.7623441344026175`*^9, 3.7623442352499657`*^9}, 3.762344266723009*^9, {
   3.762344505020522*^9, 3.7623445205951385`*^9}, {3.7699227581723967`*^9, 
   3.769922768559743*^9}, {3.770468798700423*^9, 3.7704688071686125`*^9}, {
   3.7704688389824657`*^9, 3.770468847156412*^9}, {3.772946457349085*^9, 
   3.7729464585999575`*^9}, {3.7729464955732517`*^9, 3.772946518602601*^9}, {
   3.772955194849063*^9, 3.7729552573254447`*^9}, {3.7729553982955866`*^9, 
   3.7729555931283484`*^9}, {3.7729556242444353`*^9, 
   3.7729556709746294`*^9}, {3.772955796372715*^9, 3.7729557967199755`*^9}, {
   3.772956022838584*^9, 3.7729560234990587`*^9}, {3.7729561136431174`*^9, 
   3.7729561550575066`*^9}, {3.7729573704186316`*^9, 3.772957443806794*^9}, {
   3.7729580635121303`*^9, 3.7729580777162085`*^9}, {3.77295975094604*^9, 
   3.7729597676178846`*^9}},
 CellLabel->
  "In[126]:=",ExpressionUUID->"d2071bf3-3546-4c66-8036-66ddcb1a68b4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["2. Define settings", "Subtitle",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782701661848*^9}, {3.7397827877180996`*^9, 
   3.739782797415943*^9}, {3.7398567048804107`*^9, 3.7398568049955177`*^9}, {
   3.772955180414822*^9, 3.7729551939644566`*^9}, 
   3.8449493275454493`*^9},ExpressionUUID->"14f6eaa7-e6e1-4bfa-bab8-\
defab65d1cf1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "define", " ", "the", " ", "folder", " ", "name", " ", "that", " ", 
     "contains", " ", "the", " ", "segmented", " ", "ZO"}], "-", 
    RowBox[{"1", " ", "images", " ", "generated", " ", "by", " ", "U"}], "-", 
    "Net"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"default", ":", " ", "\"\<\\\\zo1_seg\\\\\>\""}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"segFolderZo1", " ", "=", "\"\<\\\\zo1_seg\\\\\>\""}], ";"}], 
   StyleBox["\[IndentingNewLine]", "Input"], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "set", " ", "to", " ", "True", " ", "if", " ", "the", " ", "GFP", " ", 
      "analysis", " ", "function", " ", "should", " ", "be", " ", "used"}], 
     ",", " ", 
     RowBox[{
      RowBox[{
      "that", " ", "can", " ", "divide", " ", "the", " ", "cells", " ", 
       "into", " ", "two", " ", "groups", " ", "based", " ", "on", " ", "the",
        " ", "GFP", " ", 
       RowBox[{"signal", ".", " ", "For"}], " ", "each", " ", "ZO"}], "-", 
      RowBox[{
      "1", " ", "image", " ", "a", " ", "supplementary", " ", "GFP", " ", 
       "image", " ", "showing", " ", "the", " ", "same", " ", "part", " ", 
       "of", " ", "the", " ", "preparation", " ", "is", " ", 
       RowBox[{"necessary", ".", "  ", "\[IndentingNewLine]", 
        RowBox[{"Cave", ":", " ", 
         RowBox[{
         "the", " ", "number", " ", "and", " ", "alphabetic", " ", "sorting", 
          " ", "of", " ", "the", " ", "segmented", " ", "and", " ", "GFP", 
          " ", "images", " ", "need", " ", "to", " ", "be", " ", "identical", 
          " ", 
          RowBox[{"(", 
           RowBox[{
           "which", " ", "should", " ", "be", " ", "the", " ", "case", " ", 
            "when", " ", "processing", " ", "both", " ", "with", " ", "the", 
            " ", "ImageJ", " ", "script"}], ")"}]}]}]}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"default", ":", " ", "False"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gfp", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "define", " ", "the", " ", "folder", " ", "name", " ", "that", " ", 
     "contains", " ", "the", " ", "additional", " ", "GFP", " ", "images"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"default", ":", " ", "\"\<\\\\gfp\\\\\>\""}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gfpFolder", "=", " ", "\"\<\\\\gfp\\\\\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "set", " ", "to", " ", "True", " ", "if", " ", "the", " ", "single", " ",
       "branch", " ", "function", " ", "should", " ", "be", " ", 
      RowBox[{"used", ".", " ", "With"}], " ", "this", " ", "function", " ", 
      "the", " ", "cell", " ", "border", " ", "is", " ", "divided", " ", 
      "into", " ", "subsegments"}], ",", " ", 
     RowBox[{
     "that", " ", "can", " ", "be", " ", "individually", " ", "used", " ", 
      "for", " ", "modelling", " ", "and", " ", 
      RowBox[{"measurements", ".", " ", "When"}], " ", "combined", " ", 
      "with", " ", "the", " ", "GFP", " ", "function", " ", "it", " ", "can", 
      " ", "be", " ", "used", " ", "to", " ", "make", " ", "a", " ", 
      "statement", " ", "about", " ", "the", " ", "orientation", " ", "of", 
      " ", "the", " ", "cell", " ", "border", " ", "in", " ", "favour", " ", 
      "of", " ", "one", " ", "of", " ", "the", " ", "genotypes"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"default", ":", " ", "False"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"singleBranch", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "set", " ", "to", " ", "True", " ", "if", " ", "the", " ", "form", " ", 
     "analysis", " ", "function", " ", "should", " ", "be", " ", "used"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"default", ":", " ", "False"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"formAnalysis", " ", "=", " ", "False"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "The", " ", "pixel", " ", "size", " ", "depends", " ", "on", " ", "the", 
      " ", "U"}], "-", 
     RowBox[{"Net", " ", "configuration", " ", "used", " ", "for", " ", 
      RowBox[{"training", ".", " ", "It"}], " ", "defines", " ", "the", " ", 
      "size", " ", "of", " ", "1", " ", "pixel", " ", "in", " ", 
      "\[Micro]m"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"default", " ", "for", " ", "ZO"}], "-", "1"}], ":", " ", 
     "0.1024"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pixelSize", "=", "0.1024"}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782701661848*^9}, {3.7397827877180996`*^9, 
   3.7397828102040386`*^9}, {3.743432180434987*^9, 3.7434321827319355`*^9}, {
   3.761385986219534*^9, 3.7613859956121025`*^9}, {3.7613953886103444`*^9, 
   3.761395389616133*^9}, {3.7617516668769855`*^9, 3.761751673125464*^9}, {
   3.761753247270627*^9, 3.7617532475126104`*^9}, {3.762173260646184*^9, 
   3.7621732629861994`*^9}, {3.762185393375825*^9, 3.762185393882185*^9}, {
   3.762189189855327*^9, 3.762189190894086*^9}, {3.7623436944424505`*^9, 
   3.76234369495643*^9}, {3.762343882786497*^9, 3.7623439506344748`*^9}, {
   3.7623441344026175`*^9, 3.7623442352499657`*^9}, 3.762344266723009*^9, {
   3.762344505020522*^9, 3.7623445205951385`*^9}, {3.7699227581723967`*^9, 
   3.769922768559743*^9}, {3.770468798700423*^9, 3.7704688071686125`*^9}, {
   3.7704688389824657`*^9, 3.770468847156412*^9}, {3.772946457349085*^9, 
   3.7729464585999575`*^9}, {3.7729464955732517`*^9, 3.772946518602601*^9}, {
   3.772955194849063*^9, 3.7729552573254447`*^9}, {3.7729553982955866`*^9, 
   3.7729555931283484`*^9}, {3.7729556242444353`*^9, 
   3.7729556709746294`*^9}, {3.772955796372715*^9, 3.7729557967199755`*^9}, {
   3.772956022838584*^9, 3.7729560234990587`*^9}, {3.7729561136431174`*^9, 
   3.7729561550575066`*^9}, {3.7729573704186316`*^9, 3.772957443806794*^9}, {
   3.7729580635121303`*^9, 3.7729580777162085`*^9}, {3.777637022873466*^9, 
   3.7776370262868743`*^9}, {3.7776399428081837`*^9, 3.777639968687685*^9}, {
   3.7783912052395205`*^9, 3.778391209024207*^9}, {3.8168509935304823`*^9, 
   3.816851020210423*^9}, {3.844949641959958*^9, 3.8449496422481623`*^9}, {
   3.844949755658422*^9, 3.8449497757366314`*^9}, {3.844949843832822*^9, 
   3.8449498487452984`*^9}, {3.8449554332203884`*^9, 3.844955478173201*^9}, {
   3.8449557646549444`*^9, 3.8449557949253645`*^9}, {3.844955922733814*^9, 
   3.8449559743343306`*^9}, {3.844956229511917*^9, 3.8449562772547054`*^9}, {
   3.844956332791008*^9, 3.8449563463746395`*^9}, {3.844956614633486*^9, 
   3.844956713559473*^9}, {3.844956749335793*^9, 3.844956773279736*^9}, {
   3.84503124007801*^9, 3.8450313666465816`*^9}, {3.8451122798237486`*^9, 
   3.845112302610854*^9}, 3.8451133820415416`*^9, {3.845116056648138*^9, 
   3.845116066424057*^9}, {3.8451161080695286`*^9, 3.845116158979537*^9}, {
   3.845369351889633*^9, 3.8453693590717335`*^9}, {3.8456271289105425`*^9, 
   3.8456271293628826`*^9}, {3.845627685749385*^9, 3.8456276860986323`*^9}, {
   3.8456295234455175`*^9, 3.8456295240629377`*^9}, {3.8457133974023533`*^9, 
   3.8457133978927*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"3b5221c0-faa2-4603-926b-b737bdb0d073"]
}, Open  ]],

Cell[CellGroupData[{

Cell["3. Localisation of image files", "Subtitle",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
  3.73978269312477*^9, 3.739782701661848*^9}, {3.7397827877180996`*^9, 
  3.739782797415943*^9}, {3.7398567048804107`*^9, 3.7398568049955177`*^9}, {
  3.772955180414822*^9, 3.7729551939644566`*^9}, {3.772955798212017*^9, 
  3.772955814140331*^9}, {3.7729562459350834`*^9, 3.7729562703133826`*^9}, {
  3.8449493313671536`*^9, 
  3.844949334655481*^9}},ExpressionUUID->"48f6df36-bc8a-4410-9b24-\
37414251e405"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "set", " ", "working", " ", "directory", " ", "and", " ", "search", " ", 
     "in", " ", "all", " ", "subfolders"}], ",", " ", 
    RowBox[{
    "matching", " ", "the", " ", "defined", " ", "folder", " ", "name"}], ",",
     " ", 
    RowBox[{"for", " ", "image", " ", "files"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"files", "=", 
     RowBox[{"FileNames", "[", 
      RowBox[{"\"\<*.tif\>\"", ",", "\"\<\>\"", ",", " ", "Infinity"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filesZo1", " ", "=", " ", 
     RowBox[{"Select", "[", 
      RowBox[{"files", ",", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", 
          RowBox[{"__", "~~", "segFolderZo1", "~~", "__"}]}], "]"}], "&"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filesGFP", " ", "=", " ", 
     RowBox[{"Select", "[", 
      RowBox[{"files", ",", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", 
          RowBox[{"__", "~~", "gfpFolder", "~~", "__"}]}], "]"}], "&"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fileNumberZo1", " ", "=", " ", 
     RowBox[{"Length", "[", "filesZo1", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fileNumberGFP", " ", "=", " ", 
     RowBox[{"Length", "[", "filesGFP", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"\"\<Number of files: \\nZO-1 segmented: \>\"", "<>", 
    RowBox[{"ToString", "[", "fileNumberZo1", "]"}], "<>", "\"\<\\nGFP: \>\"",
     "<>", 
    RowBox[{"ToString", "[", "fileNumberGFP", " ", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"If", " ", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"fileNumberZo1", " ", "!=", "fileNumberGFP"}], " ", "&&", 
      RowBox[{"gfp", "\[Equal]", "True"}]}], ",", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"gfp", "=", "False"}], ";", 
       "\"\<GFP-Processing deactivated: file numbers don\.b4t match. Please \
double check input files\>\""}], ")"}]}], "]"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.772955850298017*^9, 3.7729558677884407`*^9}, {
   3.772955955473728*^9, 3.7729561080851383`*^9}, {3.7729561463373137`*^9, 
   3.772956168036747*^9}, {3.7729563492044272`*^9, 3.7729563616812863`*^9}, {
   3.7729574493607087`*^9, 3.7729574511419783`*^9}, 3.844949648748762*^9, {
   3.8449554867412825`*^9, 3.84495548714155*^9}, {3.8450313949756308`*^9, 
   3.8450315335667305`*^9}, 3.845112347120373*^9},
 CellLabel->"In[17]:=",ExpressionUUID->"6d5ddf3f-a237-4d3c-b8fc-9e3eeca9cc8c"],

Cell[BoxData["\<\"Number of files: \\nZO-1 segmented: 108\\nGFP: 0\"\>"], \
"Output",
 CellChangeTimes->{3.8907132443483295`*^9, 3.8907146919122057`*^9},
 CellLabel->"Out[23]=",ExpressionUUID->"dd7cfd9f-f25c-418f-b2d1-43a1bdf6b257"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["4. Processing", "Subtitle",
 CellChangeTimes->{{3.656308060469733*^9, 3.656308061773858*^9}, {
   3.73978269312477*^9, 3.739782701661848*^9}, {3.7397827877180996`*^9, 
   3.739782797415943*^9}, {3.7398567048804107`*^9, 3.7398568049955177`*^9}, {
   3.772955180414822*^9, 3.7729551939644566`*^9}, {3.772955798212017*^9, 
   3.772955814140331*^9}, {3.7729562157806435`*^9, 3.7729562309143944`*^9}, {
   3.772956273273484*^9, 3.7729562754290166`*^9}, 3.772956378144988*^9, {
   3.7737325105797834`*^9, 3.7737325635107975`*^9}, {3.8449493418085437`*^9, 
   3.844949345072853*^9}},ExpressionUUID->"682a40ea-c5aa-4407-963e-\
2194190ac9cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"side", " ", "variables", " ", "for", " ", "ProgressIndicator"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"counter", "=", 
     RowBox[{
      RowBox[{"-", "1"}], "*", 
      RowBox[{"Length", "[", 
       RowBox[{"Kernels", "[", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetSharedVariable", "[", "counter", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "call", " ", "the", " ", "main", " ", "function", " ", "to", " ", "start",
      " ", "the", " ", 
     RowBox[{"processing", ".", " ", "A"}], " ", "progress", " ", "bar", " ", 
     "shows", " ", "how", " ", "many", " ", "images", " ", "are", " ", 
     "already", " ", 
     RowBox[{"processed", ".", " ", "With"}], " ", "ParallelTable", " ", "we",
      " ", "utilize", " ", "more", " ", "CPU", " ", 
     RowBox[{"cores", ".", " ", "For"}], " ", "large", " ", "images", " ", 
     "or", " ", "computers", " ", "with", " ", "less", " ", "CPU", " ", 
     "power", " ", "switch", " ", "to", " ", "the", " ", "normal", " ", 
     "Table"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"Monitor", "[", 
     RowBox[{
      RowBox[{"ParallelTable", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"counter", "++"}], ";", 
         RowBox[{"zoAnalysis", "[", 
          RowBox[{
           RowBox[{"filesZo1", " ", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"gfp", "\[Equal]", "True"}], ",", 
             RowBox[{"filesGFP", " ", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"{", "}"}]}], "]"}], ",", "gfp", ",", "formAnalysis", 
           ",", "singleBranch", ",", "segFolderZo1"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "fileNumberZo1"}], " ", "}"}]}], "]"}], ",", 
      RowBox[{"ProgressIndicator", "[", 
       RowBox[{"counter", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "fileNumberZo1"}], " ", "}"}]}], "]"}]}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7729562068583035`*^9, 3.772956213295878*^9}, {
   3.7729565063650656`*^9, 3.7729565168355026`*^9}, {3.7729571657354603`*^9, 
   3.7729571680511045`*^9}, {3.7737302436293125`*^9, 3.7737302528372793`*^9}, 
   3.7737327089557695`*^9, {3.774333758086273*^9, 3.7743337588738327`*^9}, {
   3.816851025787382*^9, 3.816851060194809*^9}, {3.8449493455922394`*^9, 
   3.8449493461085863`*^9}, 3.8449496549691644`*^9, {3.844956817850281*^9, 
   3.8449568189030256`*^9}, {3.8449568771442437`*^9, 3.844956913431923*^9}, {
   3.8450315446835775`*^9, 3.845031577500802*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"ed8880cc-9d4c-4e1d-904a-5a91d5c3f360"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{958, 988},
WindowMargins->{{663, Automatic}, {Automatic, 171}},
FrontEndVersion->"12.1 for Microsoft Windows (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"da5c97a9-931f-44b3-8c98-ddb2ddcca6c0"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 404, 6, 96, "Title",ExpressionUUID->"c69d61bb-3e4c-4e32-ae9f-027cafb2ac21"],
Cell[987, 30, 1122, 16, 124, "Title",ExpressionUUID->"ff7b473d-92a2-473e-8f83-a3fa913a4dbc"],
Cell[CellGroupData[{
Cell[2134, 50, 412, 6, 73, "Section",ExpressionUUID->"ba39ed6b-52c8-4469-bea2-d83c376712a1"],
Cell[2549, 58, 3986, 57, 56, "Text",ExpressionUUID->"723d581d-4bbc-4f03-9cb9-83787b774a67"]
}, Closed]],
Cell[CellGroupData[{
Cell[6572, 120, 336, 5, 59, "Section",ExpressionUUID->"4fa0351b-8f85-4edc-88ad-4e22eeafcb8f"],
Cell[6911, 127, 145036, 2902, 13800, "Input",ExpressionUUID->"ca83755b-f55f-4017-827c-6439a4a15d75",
 InitializationCell->True],
Cell[151950, 3031, 65257, 1425, 7312, "Input",ExpressionUUID->"16bc000c-e236-4abb-9b42-ff78f872cab5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[217244, 4461, 326, 5, 56, "Chapter",ExpressionUUID->"be09d115-7c4d-4ac8-a107-98431ab6605e"],
Cell[217573, 4468, 457, 7, 53, "Subtitle",ExpressionUUID->"8cddcda2-3502-460b-8a40-ed065cf3a86e"],
Cell[218033, 4477, 1650, 24, 45, "Input",ExpressionUUID->"d2071bf3-3546-4c66-8036-66ddcb1a68b4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[219720, 4506, 392, 6, 53, "Subtitle",ExpressionUUID->"14f6eaa7-e6e1-4bfa-bab8-defab65d1cf1"],
Cell[220115, 4514, 7734, 147, 653, "Input",ExpressionUUID->"3b5221c0-faa2-4603-926b-b737bdb0d073"]
}, Open  ]],
Cell[CellGroupData[{
Cell[227886, 4666, 526, 8, 53, "Subtitle",ExpressionUUID->"48f6df36-bc8a-4410-9b24-37414251e405"],
Cell[CellGroupData[{
Cell[228437, 4678, 2806, 68, 363, "Input",ExpressionUUID->"6d5ddf3f-a237-4d3c-b8fc-9e3eeca9cc8c"],
Cell[231246, 4748, 232, 3, 71, "Output",ExpressionUUID->"dd7cfd9f-f25c-418f-b2d1-43a1bdf6b257"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[231527, 4757, 639, 9, 53, "Subtitle",ExpressionUUID->"682a40ea-c5aa-4407-963e-2194190ac9cc"],
Cell[232169, 4768, 2797, 61, 288, "Input",ExpressionUUID->"ed8880cc-9d4c-4e1d-904a-5a91d5c3f360"]
}, Open  ]]
}, Open  ]]
}
]
*)

